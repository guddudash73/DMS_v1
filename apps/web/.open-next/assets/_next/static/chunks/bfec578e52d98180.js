(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,46349,e=>{"use strict";let t=(0,e.i(75254).default)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);e.s(["default",()=>t])},34164,29978,33565,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(9797);let n=(0,e.i(75254).default)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);e.s(["ChevronLeftIcon",()=>n],29978);var r=e.i(46349);e.s(["ChevronRightIcon",()=>r.default],33565);var r=r,d=e.i(97791),l=e.i(75760),o=e.i(52236),i=e.i(66691);function c({className:e,classNames:a,showOutsideDays:c=!0,captionLayout:m="label",buttonVariant:x="ghost",formatters:p,components:g,...h}){let f=(0,l.getDefaultClassNames)();return(0,t.jsx)(d.DayPicker,{showOutsideDays:c,className:(0,o.cn)("bg-background group/calendar p-3 [--cell-size:--spacing(8)] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent",String.raw`rtl:**:[.rdp-button\_next>svg]:rotate-180`,String.raw`rtl:**:[.rdp-button\_previous>svg]:rotate-180`,e),captionLayout:m,formatters:{formatMonthDropdown:e=>e.toLocaleString("default",{month:"short"}),...p},classNames:{root:(0,o.cn)("w-fit",f.root),months:(0,o.cn)("flex gap-4 flex-col md:flex-row relative",f.months),month:(0,o.cn)("flex flex-col w-full gap-4",f.month),nav:(0,o.cn)("flex items-center gap-1 w-full absolute top-0 inset-x-0 justify-between",f.nav),button_previous:(0,o.cn)((0,i.buttonVariants)({variant:x}),"size-(--cell-size) aria-disabled:opacity-50 p-0 select-none",f.button_previous),button_next:(0,o.cn)((0,i.buttonVariants)({variant:x}),"size-(--cell-size) aria-disabled:opacity-50 p-0 select-none",f.button_next),month_caption:(0,o.cn)("flex items-center justify-center h-(--cell-size) w-full px-(--cell-size)",f.month_caption),dropdowns:(0,o.cn)("w-full flex items-center text-sm font-medium justify-center h-(--cell-size) gap-1.5",f.dropdowns),dropdown_root:(0,o.cn)("relative has-focus:border-ring border border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] rounded-md",f.dropdown_root),dropdown:(0,o.cn)("absolute bg-popover inset-0 opacity-0",f.dropdown),caption_label:(0,o.cn)("select-none font-medium","label"===m?"text-sm":"rounded-md pl-2 pr-1 flex items-center gap-1 text-sm h-8 [&>svg]:text-muted-foreground [&>svg]:size-3.5",f.caption_label),table:"w-full border-collapse",weekdays:(0,o.cn)("flex",f.weekdays),weekday:(0,o.cn)("text-muted-foreground rounded-md flex-1 font-normal text-[0.8rem] select-none",f.weekday),week:(0,o.cn)("flex w-full mt-2",f.week),week_number_header:(0,o.cn)("select-none w-(--cell-size)",f.week_number_header),week_number:(0,o.cn)("text-[0.8rem] select-none text-muted-foreground",f.week_number),day:(0,o.cn)("relative w-full h-full p-0 text-center [&:last-child[data-selected=true]_button]:rounded-r-md group/day aspect-square select-none",h.showWeekNumber?"[&:nth-child(2)[data-selected=true]_button]:rounded-l-md":"[&:first-child[data-selected=true]_button]:rounded-l-md",f.day),range_start:(0,o.cn)("rounded-l-md bg-accent",f.range_start),range_middle:(0,o.cn)("rounded-none",f.range_middle),range_end:(0,o.cn)("rounded-r-md bg-accent",f.range_end),today:(0,o.cn)("bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none",f.today),outside:(0,o.cn)("text-muted-foreground aria-selected:text-muted-foreground",f.outside),disabled:(0,o.cn)("text-muted-foreground opacity-50",f.disabled),hidden:(0,o.cn)("invisible",f.hidden),...a},components:{Root:({className:e,rootRef:a,...s})=>(0,t.jsx)("div",{"data-slot":"calendar",ref:a,className:(0,o.cn)(e),...s}),Chevron:({className:e,orientation:a,...d})=>"left"===a?(0,t.jsx)(n,{className:(0,o.cn)("size-4",e),...d}):"right"===a?(0,t.jsx)(r.default,{className:(0,o.cn)("size-4",e),...d}):(0,t.jsx)(s.ChevronDownIcon,{className:(0,o.cn)("size-4",e),...d}),DayButton:u,WeekNumber:({children:e,...a})=>(0,t.jsx)("td",{...a,children:(0,t.jsx)("div",{className:"flex size-(--cell-size) items-center justify-center text-center",children:e})}),...g},...h})}function u({className:e,day:s,modifiers:n,...r}){let d=(0,l.getDefaultClassNames)(),c=a.useRef(null);return a.useEffect(()=>{n.focused&&c.current?.focus()},[n.focused]),(0,t.jsx)(i.Button,{ref:c,variant:"ghost",size:"icon","data-day":s.date.toLocaleDateString(),"data-selected-single":n.selected&&!n.range_start&&!n.range_end&&!n.range_middle,"data-range-start":n.range_start,"data-range-end":n.range_end,"data-range-middle":n.range_middle,className:(0,o.cn)("data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 dark:hover:text-accent-foreground flex aspect-square size-auto w-full min-w-(--cell-size) flex-col gap-1 leading-none font-normal group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] data-[range-end=true]:rounded-md data-[range-end=true]:rounded-r-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md data-[range-start=true]:rounded-l-md [&>span]:text-xs [&>span]:opacity-70",d.day,e),...r})}e.s(["Calendar",()=>c,"CalendarDayButton",()=>u],34164)},32189,(e,t,a)=>{"use strict";t.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},65156,(e,t,a)=>{"use strict";var s=e.r(32189);function n(){}function r(){}r.resetWarningCache=n,t.exports=function(){function e(e,t,a,n,r,d){if(d!==s){var l=Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw l.name="Invariant Violation",l}}function t(){return e}e.isRequired=e;var a={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:r,resetWarningCache:n};return a.PropTypes=a,a}},45009,(e,t,a)=>{t.exports=e.r(65156)()},79506,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(18566),n=e.i(70317),r=e.i(52236),d=e.i(66691),l=e.i(69262),o=e.i(34164),i=e.i(87316),c=e.i(21806),u=e.i(14468),m=e.i(70931),x=e.i(50106),p=e.i(32595);function g(e){return"number"!=typeof e?"—":new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(e)}function h(e){return"number"==typeof e&&Number.isFinite(e)?e:0}function f({label:e,value:a,sub:s,loading:d}){return(0,t.jsx)(n.Card,{className:"rounded-2xl border-none bg-white shadow-sm",children:(0,t.jsxs)("div",{className:"p-4 md:p-5",children:[(0,t.jsx)("div",{className:"text-[11px] text-muted-foreground",children:e}),(0,t.jsx)("div",{className:(0,r.cn)("mt-1 text-xl font-semibold tracking-tight",d&&"opacity-70"),children:d?"…":a}),s?(0,t.jsx)("div",{className:"mt-1 text-[11px] text-muted-foreground",children:s}):null]})})}function b({title:e,desc:a}){return(0,t.jsx)("div",{className:"flex items-start justify-between gap-4",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-base font-semibold tracking-tight",children:e}),a?(0,t.jsx)("div",{className:"mt-0.5 text-xs text-muted-foreground",children:a}):null]})})}let v="/api";function y(){let e=(0,s.useRouter)(),r=(0,x.useAuth)(),y="authenticated"===r.status&&!!r.accessToken;(0,m.useClinicRealtimeQuery)(void 0,{skip:!y});let[j,w]=a.useState(()=>(0,p.clinicDateISO)(new Date)),[N,_]=a.useState(null),[k,C]=a.useState(!1),D=a.useMemo(()=>(function(e){if(!/^\d{4}-\d{2}-\d{2}$/.test(e))return null;let[t,a,s]=e.split("-").map(e=>Number(e));return new Date(t,a-1,s,0,0,0,0)})(j)??new Date,[j]),S=a.useMemo(()=>`/reports/payments?date=${encodeURIComponent(j)}`,[j]),[R,P]=a.useState(!1),z=a.useCallback(async()=>{if(y&&r.accessToken){P(!0);try{let e=`${v}/reports/daily/pdf?date=${encodeURIComponent(j)}`,t=await fetch(e,{method:"GET",credentials:"include",headers:{authorization:`Bearer ${r.accessToken}`}});if(!t.ok){let e=await t.text().catch(()=>"");throw Error(`Failed to download PDF (${t.status}): ${e}`)}let a=await t.blob(),s=window.URL.createObjectURL(a),n=document.createElement("a");n.href=s,n.download=`daily-report-${j}.pdf`,document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(s)}finally{P(!1)}}},[v,r.accessToken,y,j]);a.useEffect(()=>{_(null)},[j]);let T=(0,m.useGetDailyReportQuery)(j,{skip:!y}),O=(0,m.useGetDailyPatientSummaryQuery)(j,{skip:!y}),E=T.data,B=O.data,I=T.isLoading||T.isFetching,L=O.isLoading||O.isFetching,F=h(E?.visitCountsByStatus?.QUEUED),U=h(E?.visitCountsByStatus?.IN_PROGRESS),$=h(E?.visitCountsByStatus?.DONE),V=F+U+$,q=h(E?.totalRevenue),A=h(B?.newPatients),M=h(B?.followupPatients),Q=h(B?.zeroBilledVisits),W=h(B?.totalPatients),G=h(E?.onlineReceivedTotal),K=h(E?.offlineReceivedTotal),Y=a.useMemo(()=>Object.entries(E?.procedureCounts??{}).map(([e,t])=>({name:e,count:h(t)})).filter(e=>e.count>0).sort((e,t)=>t.count-e.count),[E?.procedureCounts]),H=T.isError||O.isError,Z="h-full px-3 py-4 md:px-6 md:py-6 2xl:px-10 2xl:py-10";return N?(0,t.jsx)("section",{className:Z,children:(0,t.jsxs)("div",{className:"mx-auto flex h-full w-full max-w-300 flex-col gap-6 2xl:gap-10",children:[(0,t.jsx)(c.default,{onDateSelect:e=>_(e)}),(0,t.jsx)(u.default,{date:N,onBack:()=>_(null)})]})}):(0,t.jsx)("section",{className:Z,children:(0,t.jsxs)("div",{className:"flex h-full flex-col gap-6 2xl:gap-10",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-xl font-semibold",children:"Reports"}),(0,t.jsx)("div",{className:"mt-1 text-xs text-muted-foreground",children:"Daily clinic metrics: visitors, queue, revenue and procedures."})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("div",{className:"rounded-2xl border bg-white px-3 py-2 shadow-sm",children:[(0,t.jsx)("div",{className:"text-[11px] text-muted-foreground",children:"Report date"}),(0,t.jsxs)(l.Popover,{open:k,onOpenChange:C,children:[(0,t.jsx)(l.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)(d.Button,{type:"button",variant:"outline",className:"mt-1 h-8 w-40 justify-start gap-2 rounded-xl px-2 text-xs cursor-pointer",disabled:!y,children:[(0,t.jsx)(i.Calendar,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"text-gray-900",children:j})]})}),(0,t.jsx)(l.PopoverContent,{align:"end",className:"w-auto rounded-2xl p-2",children:(0,t.jsx)(o.Calendar,{mode:"single",selected:D,onSelect:e=>{if(e){let t,a,s;w((t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0"),`${t}-${a}-${s}`)),C(!1)}}})})]})]}),(0,t.jsx)(d.Button,{type:"button",variant:"outline",className:"h-10 rounded-2xl px-3 text-xs cursor-pointer",disabled:!y||R,onClick:z,title:"Download daily report as PDF",children:R?"Downloading…":"Download PDF"})]})]}),y?H?(0,t.jsx)("div",{className:"rounded-2xl border border-red-200 bg-red-50 p-4 text-sm text-red-700",children:"Couldn't load reports for this date."}):null:(0,t.jsx)("div",{className:"rounded-2xl border bg-white p-4 text-sm text-muted-foreground",children:"Please login to view reports."}),(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-6 2xl:gap-10 sm:grid-cols-2 lg:grid-cols-4",children:[(0,t.jsx)(f,{label:"Payments received",value:(0,t.jsx)("span",{className:"tabular-nums",children:g(G+K)}),sub:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsxs)("span",{className:"truncate",children:["Online ",g(G)," · Offline ",g(K)]}),(0,t.jsx)(d.Button,{type:"button",variant:"outline",size:"sm",className:"h-7 rounded-xl px-2 text-[11px] cursor-pointer",disabled:!y,onClick:()=>e.push(S),title:"View all received payments",children:"View all →"})]}),loading:I}),(0,t.jsx)(f,{label:"Visitors",value:W,sub:(0,t.jsxs)("span",{children:[A," new · ",M," follow-up · ",Q," zero-billed"]}),loading:L}),(0,t.jsx)(f,{label:"Total revenue",value:g(q),sub:(0,t.jsxs)("span",{children:["For ",(0,p.formatClinicDatePretty)(j)]}),loading:I}),(0,t.jsx)(f,{label:"Avg. revenue",value:g(V>0?q/V:0),sub:(0,t.jsxs)("span",{children:["Per visit · ",g($>0?q/$:0)," per done"]}),loading:I})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-6 2xl:gap-10 lg:grid-cols-3",children:[(0,t.jsx)("div",{className:"lg:col-span-2",children:(0,t.jsx)(c.default,{onDateSelect:e=>_(e)})}),(0,t.jsx)(n.Card,{className:"rounded-2xl border-none bg-white shadow-sm",children:(0,t.jsxs)("div",{className:"p-4 md:p-5",children:[(0,t.jsx)(b,{title:"Daily highlights",desc:"Quick view of what happened on this day."}),(0,t.jsxs)("div",{className:"mt-4 grid grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{className:"rounded-xl bg-slate-50 px-3 py-2",children:[(0,t.jsx)("div",{className:"text-[11px] text-muted-foreground",children:"Completed visits"}),(0,t.jsx)("div",{className:"mt-0.5 text-base font-semibold",children:I?"…":$})]}),(0,t.jsxs)("div",{className:"rounded-xl bg-slate-50 px-3 py-2",children:[(0,t.jsx)("div",{className:"text-[11px] text-muted-foreground",children:"Zero billed"}),(0,t.jsx)("div",{className:"mt-0.5 text-base font-semibold",children:L?"…":Q})]}),(0,t.jsxs)("div",{className:"rounded-xl bg-slate-50 px-3 py-2",children:[(0,t.jsx)("div",{className:"text-[11px] text-muted-foreground",children:"New patients"}),(0,t.jsx)("div",{className:"mt-0.5 text-base font-semibold",children:L?"…":A})]}),(0,t.jsxs)("div",{className:"rounded-xl bg-slate-50 px-3 py-2",children:[(0,t.jsx)("div",{className:"text-[11px] text-muted-foreground",children:"Follow-ups"}),(0,t.jsx)("div",{className:"mt-0.5 text-base font-semibold",children:L?"…":M})]})]}),(0,t.jsx)("button",{type:"button",onClick:()=>_(j),className:"mt-4 w-full rounded-xl border bg-white px-3 py-2 text-xs font-medium shadow-sm hover:bg-slate-50 disabled:opacity-60 cursor-pointer",disabled:!y,title:"Open daily breakdown",children:"View daily breakdown →"})]})})]}),(0,t.jsx)(n.Card,{className:"rounded-2xl border-none bg-white shadow-sm",children:(0,t.jsxs)("div",{className:"p-4 md:p-5",children:[(0,t.jsx)(b,{title:"Procedure & billing lines",desc:"Counts aggregated from billing line items for this day."}),(0,t.jsx)("div",{className:"mt-4",children:I?(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("div",{className:"h-10 w-full animate-pulse rounded-xl bg-slate-100"}),(0,t.jsx)("div",{className:"h-10 w-full animate-pulse rounded-xl bg-slate-100"}),(0,t.jsx)("div",{className:"h-10 w-full animate-pulse rounded-xl bg-slate-100"})]}):0===Y.length?(0,t.jsx)("div",{className:"rounded-xl border bg-white px-3 py-3 text-sm text-muted-foreground",children:"No procedure/billing line items found for this day."}):(0,t.jsxs)("div",{className:"overflow-hidden rounded-2xl border",children:[(0,t.jsxs)("div",{className:"grid grid-cols-12 bg-slate-50 px-4 py-2 text-[11px] font-semibold text-slate-600",children:[(0,t.jsx)("div",{className:"col-span-9",children:"Procedure / Code"}),(0,t.jsx)("div",{className:"col-span-3 text-right",children:"Count"})]}),(0,t.jsx)("div",{className:"divide-y",children:Y.slice(0,40).map(e=>(0,t.jsxs)("div",{className:"grid grid-cols-12 px-4 py-2 text-sm",children:[(0,t.jsx)("div",{className:"col-span-9 truncate",children:e.name}),(0,t.jsx)("div",{className:"col-span-3 text-right font-mono tabular-nums",children:e.count.toLocaleString()})]},e.name))}),Y.length>40?(0,t.jsxs)("div",{className:"border-t bg-white px-4 py-2 text-[11px] text-muted-foreground",children:["Showing top 40. (",Y.length," total)"]}):null]})})]})})]})})}e.s(["default",()=>y])}]);