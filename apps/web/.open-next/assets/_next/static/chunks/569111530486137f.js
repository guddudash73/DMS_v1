(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,28430,11888,e=>{"use strict";var t=e.i(43476),s=e.i(71645),r=e.i(57688),i=e.i(70931),a=e.i(82879);function l({xrayId:e,open:l,onOpenChange:n}){let[d,o]=(0,s.useState)(e);(0,s.useEffect)(()=>{l&&o(e)},[l,e]);let{data:c,isFetching:u,isError:x}=(0,i.useGetXrayUrlQuery)({xrayId:d??"",size:"original"},{skip:!l||!d});return(0,t.jsx)(a.Dialog,{open:l,onOpenChange:n,children:(0,t.jsxs)(a.DialogContent,{className:"max-w-4xl",children:[(0,t.jsx)(a.DialogHeader,{children:(0,t.jsx)(a.DialogTitle,{children:"X-ray Viewer"})}),(0,t.jsx)("div",{className:"relative w-full overflow-hidden rounded-xl border bg-white",children:(0,t.jsxs)("div",{className:"flex min-h-105 items-center justify-center p-4",children:[u&&(0,t.jsx)("div",{className:"text-sm text-gray-500",children:"Loading…"}),x&&(0,t.jsx)("div",{className:"text-sm text-red-600",children:"Failed to load image."}),c?.url&&(0,t.jsx)(r.default,{src:c.url,alt:"X-ray",width:1200,height:900,className:"h-auto w-full object-contain",unoptimized:!0})]})})]})})}e.s(["XrayViewerModal",()=>l],11888);var n=e.i(32595);function d({xrayId:e,enabled:a}){let{ref:l,inView:n}=function(e){let t=(0,s.useRef)(null),[r,i]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{let s=t.current;if(!s)return;let r=new IntersectionObserver(e=>{let t=e[0];t&&t.isIntersecting&&i(!0)},e);return r.observe(s),()=>r.disconnect()},[e]),{ref:t,inView:r}}({rootMargin:"250px"}),{data:d}=(0,i.useGetXrayUrlQuery)({xrayId:e,size:"thumb"},{skip:!(a&&n)});return(0,t.jsx)("div",{ref:l,className:"h-18 w-18",children:d?.url?(0,t.jsx)(r.default,{src:d.url,alt:"X-ray thumb",width:160,height:160,className:"h-18 w-18 rounded-xl object-cover",unoptimized:!0}):(0,t.jsx)("div",{className:"h-18 w-18 rounded-xl bg-gray-100"})})}function o({visitId:e}){let{data:r,isLoading:a,isError:o,refetch:c}=(0,i.useListVisitXraysQuery)({visitId:e}),u=r?.items??[],x=(0,s.useMemo)(()=>!a&&!o&&0===u.length,[a,o,u.length]),[m,h]=(0,s.useState)(!1),[g,y]=(0,s.useState)(null),[f,j]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{let e=!1,t=()=>{e||j(!0)},s=window.requestIdleCallback;if("function"==typeof s){let r=s(t,{timeout:800});return()=>{e=!0;let t=window.cancelIdleCallback;t?.(r)}}let r=window.setTimeout(t,450);return()=>{e=!0,window.clearTimeout(r)}},[e]),(0,t.jsxs)("div",{className:"rounded-2xl border bg-white p-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("div",{className:"text-sm font-semibold text-gray-900",children:"X-rays"}),(0,t.jsx)("button",{type:"button",className:"text-xs text-gray-600 hover:underline",onClick:()=>void c(),children:"Refresh"})]}),a&&(0,t.jsx)("div",{className:"mt-2 text-xs text-gray-500",children:"Loading…"}),o&&(0,t.jsx)("div",{className:"mt-2 text-xs text-red-600",children:"Failed to load X-rays."}),x&&(0,t.jsx)("div",{className:"mt-2 text-xs text-gray-500",children:"No X-rays uploaded yet."}),u.length>0&&(0,t.jsx)("div",{className:"mt-3 flex flex-wrap gap-3",children:u.map(e=>{let s;return(0,t.jsxs)("button",{type:"button",className:"group rounded-2xl border bg-white p-2 pb-3 transition hover:shadow-sm focus:outline-none focus:ring-2 focus:ring-gray-900/10",onClick:()=>{y(e.xrayId),h(!0)},children:[(0,t.jsx)(d,{xrayId:e.xrayId,enabled:f}),(0,t.jsxs)("div",{className:"mt-2 text-left",children:[(0,t.jsx)("div",{className:"text-[11px] font-medium text-gray-800",children:Number.isFinite((s=new Date(e.takenAt)).getTime())?new Intl.DateTimeFormat("en-IN",{timeZone:n.CLINIC_TZ,day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0}).format(s):"—"}),(0,t.jsxs)("div",{className:"text-[10px] text-gray-500",children:[Math.round(e.size/1024)," KB"]})]})]},e.xrayId)})}),g&&(0,t.jsx)(l,{xrayId:g,open:m,onOpenChange:e=>{h(e),e||y(null)}})]})}e.s(["XrayTrayReadOnly",()=>o],28430)},77950,e=>{e.n(e.i(28430))}]);