(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,14154,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(18566),i=e.i(70319),n=e.i(70317),r=e.i(66691),l=e.i(23621),d=e.i(85449),o=e.i(89169),c=e.i(70931),u=e.i(55487),x=e.i(52236);async function m(e){await new Promise(t=>setTimeout(t,e))}async function p(e,t,s,a,i){await new Promise((n,r)=>{let l=new XMLHttpRequest;for(let[t,a]of(i.current=l,l.open("PUT",e,!0),Object.entries(s)))l.setRequestHeader(t,a);l.upload.onprogress=e=>{e.lengthComputable&&a(Math.round(e.loaded/e.total*100))},l.onload=()=>{if(l.status>=200&&l.status<300)return n();r(Error(`Upload failed with status ${l.status}`))},l.onerror=()=>r(Error("Network error during upload")),l.onabort=()=>r(Error("Upload aborted")),l.send(t)})}function h({visitId:e,onUploaded:a,variant:n="default",className:l}){let d=(0,s.useRef)(null),o=(0,s.useRef)(null),[h,g]=(0,s.useState)(0),[f,v]=(0,s.useState)(!1),[y]=(0,c.usePresignXrayUploadMutation)(),[b]=(0,c.useRegisterXrayMetadataMutation)(),j=(0,u.useSelector)(e=>e.auth.userId),N=(0,s.useMemo)(()=>f?h>0&&h<100?`Uploading… ${h}%`:"Uploading…":"Upload X-Ray",[f,h]),w=async t=>{let s="image/jpeg"===t.type?"image/jpeg":"image/png"===t.type?"image/png":null;if(!s)return void i.toast.error("Only JPG/PNG images are supported.");if(t.size<1024)return void i.toast.error("File too small.");if(t.size>0xa00000)return void i.toast.error("File too large (max 10MB).");if(!j)return void i.toast.error("Missing user session. Please re-login.");v(!0),g(0);try{let n=await y({visitId:e,contentType:s,size:t.size}).unwrap(),r=null;for(let e=1;e<=3;e++)try{await p(n.uploadUrl,t,n.headers??{"Content-Type":s},e=>g(e),o),r=null;break}catch(t){if(r=t,3===e)break;await m(200*e)}if(r)throw r;let l={visitId:e,xrayId:n.xrayId,contentType:s,size:t.size,takenAt:Date.now(),contentKey:n.key,...{takenByUserId:j}};await b(l).unwrap(),i.toast.success("X-ray uploaded."),a?.()}catch(e){i.toast.error(function(e){if(e){if("object"==typeof e){let t=e.message;if("string"==typeof t&&t.trim())return t;let s=e.data;if(s&&"object"==typeof s){let e=s.message;if("string"==typeof e&&e.trim())return e}}if("string"==typeof e&&e.trim())return e}}(e)??"Upload failed.")}finally{v(!1),g(0),o.current=null,d.current&&(d.current.value="")}};return(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{ref:d,type:"file",accept:"image/jpeg,image/png",className:"hidden",onChange:e=>{let t=e.target.files?.[0];t&&w(t)}}),(0,t.jsx)(r.Button,{type:"button",variant:n,onClick:()=>d.current?.click(),disabled:f,className:(0,x.cn)("rounded-xl","default"===n?"bg-black text-white hover:bg-black/90":"",l),children:N}),f&&(0,t.jsx)(r.Button,{type:"button",variant:"ghost",onClick:()=>{o.current&&o.current.abort()},className:"rounded-xl",children:"Cancel"})]})}var g=e.i(57688),f=e.i(27612),v=e.i(11888),y=e.i(82879),b=e.i(32595);function j({xrayId:e}){let{data:s}=(0,c.useGetXrayUrlQuery)({xrayId:e,size:"thumb"});return s?.url?(0,t.jsx)(g.default,{src:s.url,alt:"X-ray thumb",width:160,height:160,className:"h-18 w-18 cursor-pointer rounded-xl object-cover",unoptimized:!0}):(0,t.jsx)("div",{className:"h-18 w-18 rounded-xl bg-gray-100"})}function N({visitId:e,variant:a="standalone",canDelete:n=!0}){let{data:l,isLoading:d,isError:o,refetch:u}=(0,c.useListVisitXraysQuery)({visitId:e}),x=l?.items??[],[m,p]=(0,s.useState)(!1),[h,g]=(0,s.useState)(null),[N,w]=(0,c.useDeleteXrayMutation)(),[I,C]=(0,s.useState)(!1),[S,M]=(0,s.useState)(null),D=(0,s.useMemo)(()=>!d&&!o&&0===x.length,[d,o,x.length]),T=async()=>{if(S)try{await N({visitId:e,xrayId:S}).unwrap(),h===S&&(p(!1),g(null)),i.toast.success("X-ray deleted."),C(!1),M(null)}catch(e){i.toast.error(function(e){if(e&&"object"==typeof e){let t=e.message;if("string"==typeof t&&t.trim())return t;let s=e.data;if(s&&"object"==typeof s){let e=s.message;if("string"==typeof e&&e.trim())return e}}}(e)??"Failed to delete X-ray.")}};return(0,t.jsxs)("div",{className:"embedded"===a?"rounded-xl border bg-white p-3":"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("div",{className:"text-sm font-semibold text-gray-900",children:"X-rays"}),(0,t.jsx)("button",{type:"button",className:"text-xs text-gray-600 hover:underline",onClick:()=>void u(),children:"Refresh"})]}),d&&(0,t.jsx)("div",{className:"mt-2 text-xs text-gray-500",children:"Loading…"}),o&&(0,t.jsx)("div",{className:"mt-2 text-xs text-red-600",children:"Failed to load X-rays."}),D&&(0,t.jsx)("div",{className:"mt-2 text-xs text-gray-500",children:"No X-rays uploaded yet."}),x.length>0&&(0,t.jsx)("div",{className:"mt-3 flex flex-wrap gap-3",children:x.map(e=>{let s;return(0,t.jsxs)("div",{className:"group relative rounded-2xl border bg-white p-2 pb-4 transition hover:shadow-sm",children:[(0,t.jsx)("button",{type:"button",className:"relative block rounded-xl focus:outline-none focus:ring-2 focus:ring-gray-900/20",onClick:()=>{g(e.xrayId),p(!0)},"aria-label":"Open X-ray",children:(0,t.jsx)(j,{xrayId:e.xrayId})}),n?(0,t.jsx)(r.Button,{type:"button",variant:"ghost",size:"icon",className:"absolute bottom-0 right-0 h-8 w-8 cursor-pointer rounded-2xl",onClick:t=>{t.preventDefault(),t.stopPropagation(),M(e.xrayId),C(!0)},"aria-label":"Delete X-ray",children:(0,t.jsx)(f.Trash2,{className:"h-4 w-4"})}):null,(0,t.jsxs)("div",{className:"mt-2 text-left",children:[(0,t.jsx)("div",{className:"text-[11px] font-medium text-gray-800",children:Number.isFinite((s=new Date(e.takenAt)).getTime())?new Intl.DateTimeFormat("en-IN",{timeZone:b.CLINIC_TZ,day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0}).format(s):"—"}),(0,t.jsxs)("div",{className:"text-[10px] text-gray-500",children:[Math.round(e.size/1024)," KB"]})]})]},e.xrayId)})}),h&&(0,t.jsx)(v.XrayViewerModal,{xrayId:h,open:m,onOpenChange:e=>{p(e),e||g(null)}}),n?(0,t.jsx)(y.Dialog,{open:I,onOpenChange:e=>{C(e),e||M(null)},children:(0,t.jsxs)(y.DialogContent,{className:"max-w-md",children:[(0,t.jsx)(y.DialogHeader,{children:(0,t.jsx)(y.DialogTitle,{children:"Delete X-ray?"})}),(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"This will permanently delete the X-ray for this visit. You can’t undo this action."}),(0,t.jsxs)("div",{className:"mt-4 flex items-center justify-end gap-2",children:[(0,t.jsx)(r.Button,{type:"button",variant:"ghost",className:"rounded-xl",onClick:()=>C(!1),disabled:w.isLoading,children:"Cancel"}),(0,t.jsx)(r.Button,{type:"button",variant:"destructive",className:"rounded-xl",onClick:()=>void T(),disabled:w.isLoading,children:w.isLoading?"Deleting…":"Delete"})]})]})}):null]})}var w=e.i(28430),I=e.i(69262),C=e.i(34164),S=e.i(23442),M=e.i(7064),D=e.i(29978),T=e.i(33565);let k=(0,e.i(75254).default)("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);function O({className:e,...s}){return(0,t.jsx)("nav",{role:"navigation","aria-label":"pagination","data-slot":"pagination",className:(0,x.cn)("mx-auto flex w-full justify-center",e),...s})}function R({className:e,...s}){return(0,t.jsx)("ul",{"data-slot":"pagination-content",className:(0,x.cn)("flex flex-row items-center gap-1",e),...s})}function L({...e}){return(0,t.jsx)("li",{"data-slot":"pagination-item",...e})}function B({className:e,isActive:s,size:a="icon",...i}){return(0,t.jsx)("a",{"aria-current":s?"page":void 0,"data-slot":"pagination-link","data-active":s,className:(0,x.cn)((0,r.buttonVariants)({variant:s?"outline":"ghost",size:a}),e),...i})}function A({className:e,...s}){return(0,t.jsxs)(B,{"aria-label":"Go to previous page",size:"default",className:(0,x.cn)("gap-1 px-2.5 sm:pl-2.5",e),...s,children:[(0,t.jsx)(D.ChevronLeftIcon,{}),(0,t.jsx)("span",{className:"hidden sm:block",children:"Previous"})]})}function E({className:e,...s}){return(0,t.jsxs)(B,{"aria-label":"Go to next page",size:"default",className:(0,x.cn)("gap-1 px-2.5 sm:pr-2.5",e),...s,children:[(0,t.jsx)("span",{className:"hidden sm:block",children:"Next"}),(0,t.jsx)(T.ChevronRightIcon,{})]})}function P({className:e,...s}){return(0,t.jsxs)("span",{"aria-hidden":!0,"data-slot":"pagination-ellipsis",className:(0,x.cn)("flex size-9 items-center justify-center",e),...s,children:[(0,t.jsx)(k,{className:"size-4"}),(0,t.jsx)("span",{className:"sr-only",children:"More pages"})]})}function U(e,t){let s=[];for(let a=e;a<=t;a++)s.push(a);return s}function V({page:e,totalItems:a,pageSize:i,onPageChange:n,siblingCount:r=1,className:l,disabled:d=!1}){let o=Math.max(1,Math.ceil(a/i)),c=Math.max(1,Math.min(o,e));if(o<=1)return null;let u=s.useMemo(()=>(function(e){let{page:t,totalPages:s,siblingCount:a}=e;if(s<=2*a+5)return U(1,s);let i=Math.max(t-a,1),n=Math.min(t+a,s),r=i>2,l=n<s-1;return!r&&l?[...U(1,1+(2*a+2)),"...",s]:r&&!l?[1,"...",...U(s-(1+(2*a+2))+1,s)]:[1,"...",...U(i,n),"...",s]})({page:c,totalPages:o,siblingCount:r}),[c,o,r]),x=c>1&&!d,m=c<o&&!d;return(0,t.jsx)(O,{className:l,children:(0,t.jsxs)(R,{children:[(0,t.jsx)(L,{children:(0,t.jsx)(A,{"aria-disabled":!x,tabIndex:x?0:-1,className:x?void 0:"pointer-events-none opacity-50",onClick:e=>{e.preventDefault(),x&&n(c-1)}})}),u.map((e,s)=>"..."===e?(0,t.jsx)(L,{children:(0,t.jsx)(P,{})},`e-${s}`):(0,t.jsx)(L,{children:(0,t.jsx)(B,{isActive:e===c,onClick:t=>{t.preventDefault(),d||n(e)},children:e})},e)),(0,t.jsx)(L,{children:(0,t.jsx)(E,{"aria-disabled":!m,tabIndex:m?0:-1,className:m?void 0:"pointer-events-none opacity-50",onClick:e=>{e.preventDefault(),m&&n(c+1)}})})]})})}var F=e.i(87316),$=e.i(24911),X=e.i(6662);let G=["UL","UR","LL","LR"];function z(e){let t=(e??"").trim();if(!t)return[];let s=t.split(/[,\s]+/g).map(e=>e.trim()).filter(Boolean),a=new Set,i=[];for(let e of s)if(!a.has(e)&&(a.add(e),i.push(e),i.length>=8))break;return i}function H(e){return(e??[]).join(", ")}function Q({value:e,onChange:a,disabled:i}){let[n,l]=(0,s.useState)(""),[d,o]=(0,s.useState)(""),[c,u]=(0,s.useState)(""),[x,m]=(0,s.useState)(""),[p,h]=(0,s.useState)("");(0,s.useEffect)(()=>{let{byPos:t,note:s}=function(e){let t={UL:[],UR:[],LL:[],LR:[]};for(let s of e??[]){if(!s?.position)continue;let e=s.position;t[e]=[...t[e]??[],...s.toothNumbers??[]].filter(Boolean)}for(let e of G){let s=new Set,a=[];for(let i of t[e]??[]){let e=String(i).trim();if(e&&!s.has(e)&&(s.add(e),a.push(e),a.length>=8))break}t[e]=a}return{byPos:t,note:(e??[]).map(e=>e?.notes?.trim()).find(e=>e&&e.length>0)??""}}(e??[]);l(H(t.UL)),o(H(t.UR)),u(H(t.LL)),m(H(t.LR)),h(s)},[JSON.stringify(e??[])]);let g=(0,s.useMemo)(()=>{let e={UL:z(n),UR:z(d),LL:z(c),LR:z(x)},t=p.trim(),s=[];return G.filter(t=>(e[t]?.length??0)>0).forEach((a,i)=>{s.push({position:a,toothNumbers:e[a],...t&&0===i?{notes:t}:{}})}),s},[n,d,c,x,p]),v=(0,s.useMemo)(()=>(g?.length??0)>0,[g]),y="h-7 w-full rounded-none border-0 bg-transparent px-1 text-center text-[12px] font-semibold leading-none text-gray-900 shadow-none focus-visible:ring-0 focus-visible:ring-offset-0";return(0,t.jsxs)("div",{className:"w-full overflow-hidden rounded-xl border bg-white",children:[(0,t.jsxs)("div",{className:"bg-white px-3 py-3",children:[(0,t.jsx)("div",{className:"mb-2 text-sm font-semibold text-gray-900",children:"Teeth"}),(0,t.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-start",children:[(0,t.jsx)("div",{className:"shrink-0",children:(0,t.jsx)("div",{className:"inline-block overflow-hidden rounded-[6px] border border-gray-400",children:(0,t.jsxs)("div",{className:"grid grid-cols-2",children:[(0,t.jsx)("div",{className:"border-b border-r border-gray-700",children:(0,t.jsx)($.Input,{disabled:i,value:n,onChange:e=>l(e.target.value),placeholder:"",className:y})}),(0,t.jsx)("div",{className:"border-b border-gray-700",children:(0,t.jsx)($.Input,{disabled:i,value:d,onChange:e=>o(e.target.value),placeholder:"",className:y})}),(0,t.jsx)("div",{className:"border-r border-gray-700",children:(0,t.jsx)($.Input,{disabled:i,value:c,onChange:e=>u(e.target.value),placeholder:"",className:y})}),(0,t.jsx)("div",{children:(0,t.jsx)($.Input,{disabled:i,value:x,onChange:e=>m(e.target.value),placeholder:"",className:y})})]})})}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("div",{className:"mb-1 text-[11px] font-semibold text-gray-700",children:"Notes (single)"}),(0,t.jsx)(X.Textarea,{disabled:i,value:p,onChange:e=>h(e.target.value),className:"min-h-9.5 resize-none rounded-xl",placeholder:"Optional notes…"})]})]}),(0,t.jsxs)("div",{className:"mt-3 flex items-center gap-2",children:[(0,t.jsx)(r.Button,{type:"button",className:"rounded-xl",disabled:i,onClick:()=>{i||a(g)},title:v?"Save teeth details":"Nothing to save",children:"Save Teeth"}),(0,t.jsxs)(r.Button,{type:"button",variant:"outline",className:"rounded-xl",disabled:i,onClick:()=>{i||(l(""),o(""),u(""),m(""),h(""),a([]))},children:[(0,t.jsx)(f.Trash2,{className:"mr-2 h-4 w-4"}),"Clear"]}),(0,t.jsxs)("div",{className:"ml-auto text-[11px] text-gray-500",children:["Stored: ",v?`${g.length} quadrant(s)`:"—"]})]})]}),(0,t.jsx)("div",{className:"border-t px-3 py-2 text-sm",children:e?.length?(0,t.jsxs)("div",{className:"text-gray-700",children:["Current:"," ",G.map(s=>{let a=(e??[]).find(e=>e.position===s),i=a?.toothNumbers?.length?a.toothNumbers.join(", "):"—";return(0,t.jsxs)("span",{className:"mr-3",children:[(0,t.jsx)("span",{className:"font-semibold",children:s}),": ",i]},s)})]}):(0,t.jsx)("div",{className:"text-gray-500",children:"No teeth details saved yet."})})]})}function W(e){return"object"==typeof e&&null!==e}function _(e){return"string"==typeof e&&e.trim()?e:void 0}function q(e){if(!e)return null;if(e instanceof Date)return Number.isFinite(e.getTime())?e:null;if("number"==typeof e){let t=new Date(e);return Number.isFinite(t.getTime())?t:null}if("string"==typeof e){let t=e.trim();if(!t)return null;let s=new Date(t);return Number.isFinite(s.getTime())?s:null}return null}function J(e,t){let s=t.getFullYear()-e.getFullYear(),a=t.getMonth()-e.getMonth();return(a<0||0===a&&t.getDate()<e.getDate())&&(s-=1),s<0?0:s}function Z(e){if(!e)return!0;let t=e.trim();return!!(!t||/^Doctor\s*\(.+\)$/i.test(t)||/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(t))}function K({lines:e}){return e.length?(0,t.jsx)("div",{className:"mt-3 overflow-hidden rounded-2xl border",children:(0,t.jsxs)(M.Table,{children:[(0,t.jsx)(M.TableHeader,{children:(0,t.jsxs)(M.TableRow,{className:"bg-gray-50",children:[(0,t.jsx)(M.TableHead,{className:"font-semibold text-gray-600",children:"#"}),(0,t.jsx)(M.TableHead,{className:"font-semibold text-gray-600",children:"Medicine"})]})}),(0,t.jsx)(M.TableBody,{children:e.map((e,s)=>{let a,i,n,r,l,d,o,c,u=W(e)?e:{},x=u.id,m=u.rxLineId,p="string"==typeof x?x:"string"==typeof m?m:`${s}`;return(0,t.jsxs)(M.TableRow,{className:"hover:bg-gray-50/60",children:[(0,t.jsx)(M.TableCell,{className:"w-15 text-gray-700",children:s+1}),(0,t.jsx)(M.TableCell,{className:"text-gray-800",children:(i="string"==typeof(a=W(e)?e:{}).medicineName&&a.medicineName.trim()||"string"==typeof a.medicine&&a.medicine.trim()||"Medicine",n=null!=a.dose?String(a.dose):"",r=null!=a.frequency?String(a.frequency):"",l=void 0!==a.days&&null!==a.days&&""!==a.days?String(a.days):"",d=null!=a.timing?String(a.timing):"",o=null!=a.notes?String(a.notes):"",c=[n,r,l?`${l} days`:"",d].filter(Boolean),`${i}${c.length?` — ${c.join(" · ")}`:""}${o?` — ${o}`:""}`)})]},p)})})]})}):(0,t.jsx)("div",{className:"mt-3 text-sm text-gray-500",children:"No medicines added."})}function Y(e){let{open:a,onOpenChange:i,visitId:n,patientId:r,patientName:l,patientPhone:o,patientSdId:u,opdNo:x,doctorName:m,doctorRegdLabel:p}=e,h=(0,c.useGetVisitRxQuery)({visitId:n??""},{skip:!a||!n}),g=(0,c.useGetVisitByIdQuery)(n??"",{skip:!a||!n}),f=(0,c.useGetPatientByIdQuery)(r??"",{skip:!a||!r}),v=(0,c.useGetPatientVisitsQuery)(r??"",{skip:!a||!r,refetchOnMountOrArgChange:!0}),j=v.data?.items??[],N=(0,s.useMemo)(()=>{let e=g.data;return q(W(e)?e.createdAt:void 0)},[g.data]),w=(0,s.useMemo)(()=>{let e=N?.getTime();return e?`Visit: ${(0,b.clinicDateISOFromMs)(e)}`:""},[N]),I=(0,s.useMemo)(()=>{let e=f.data,t=W(e)?e:{},s=String(t.sex??t.gender??t.patientSex??"").trim().toUpperCase();return"M"===s||"F"===s||"O"===s||"U"===s?s:"MALE"===s?"M":"FEMALE"===s?"F":"OTHER"===s?"O":void 0},[f.data]),C=(0,s.useMemo)(()=>{let e=f.data,t=W(e)?e:{},s=q(t.dob??t.dateOfBirth??t.birthDate??t.dobIso??null),a=N??new Date;if(s)return J(s,a)},[f.data,N]),S=h.data?.rx?.lines??[],M=(0,s.useMemo)(()=>{let e=h.data?.rx;if(!e||!W(e))return[];let t=e.toothDetails;return Array.isArray(t)?t:[]},[h.data]),D=(0,s.useMemo)(()=>{let e=n??"",t=new Map;for(let e of j)t.set(e.visitId,e);let s=g.data;W(s)&&"string"==typeof s.visitId&&t.set(s.visitId,s);let a=t.get(e)??s,i=W(a)?a:{},r=_(i.tag),l=_(i.anchorVisitId),d="F"===r?l:e;if(!d)return{visitIds:e?[e]:[],meta:t,currentVisitId:e};let o=[],c=t.get(d);c&&o.push(c);let u=[];for(let e of t.values()){let t=_((W(e)?e:{}).anchorVisitId);t&&t===d&&e.visitId!==d&&u.push(e)}if(u.sort((e,t)=>(e.createdAt??e.updatedAt??0)-(t.createdAt??t.updatedAt??0)),o.push(...u),e&&!o.some(t=>t.visitId===e)){let s=t.get(e);o.push(s??{visitId:e})}o.sort((e,t)=>(e.createdAt??e.updatedAt??0)-(t.createdAt??t.updatedAt??0));let x=new Set,m=o.map(e=>e.visitId).filter(e=>!(!e||x.has(e))&&(x.add(e),!0)),p=e?m.indexOf(e):-1;return{visitIds:p>=0?m.slice(0,p+1):m,meta:t,currentVisitId:e}},[j,n,g.data]),T=(0,s.useMemo)(()=>{let e=g.data,t=W(e)?e:{},s=t.opdNo??t.opdNumber??t.opdId??t.opd??t.opd_no??t.opd_no_str??void 0;return(null==s?"":String(s).trim())||void 0},[g.data]);return(0,t.jsx)(y.Dialog,{open:a,onOpenChange:i,children:(0,t.jsxs)(y.DialogContent,{className:"max-w-5xl rounded-2xl",children:[(0,t.jsx)(y.DialogHeader,{children:(0,t.jsx)(y.DialogTitle,{children:"Prescription"})}),(0,t.jsx)("div",{className:"min-w-0 overflow-x-hidden rounded-2xl border bg-white p-4",children:h.isFetching||g.isFetching||f.isFetching?(0,t.jsx)("div",{className:"text-sm text-gray-500",children:"Loading…"}):n?(0,t.jsx)(d.PrescriptionPreview,{patientName:f.data?.name??l,patientPhone:f.data?.phone??o,patientAge:C,patientSex:I,sdId:f.data?.sdId??u,opdNo:T??x,doctorName:m,doctorRegdLabel:p,visitDateLabel:w,lines:S,toothDetails:M,currentVisitId:D.currentVisitId,chainVisitIds:D.visitIds,visitMetaMap:D.meta}):(0,t.jsx)("div",{className:"text-sm text-gray-500",children:"Invalid visit."})})]})})}function ee(e){let{open:s,onOpenChange:a,visitId:i}=e;return(0,t.jsx)(y.Dialog,{open:s,onOpenChange:a,children:(0,t.jsxs)(y.DialogContent,{className:"max-w-5xl rounded-2xl",children:[(0,t.jsx)(y.DialogHeader,{children:(0,t.jsx)(y.DialogTitle,{children:"X-rays"})}),i?(0,t.jsx)(w.XrayTrayReadOnly,{visitId:i}):null]})})}function et(e){let t=W(e)?e:{};return _(t.anchorVisitId)??_(t.anchorId)??void 0}function es(e){return!!(W(e)?e:{}).zeroBilled}function ea(e){return"NEW"===e?"bg-sky-100 text-sky-700 border-sky-200":"bg-violet-100 text-violet-700 border-violet-200"}function ei(){return"bg-rose-100 text-rose-700 border-rose-200"}function en(e){return"QUEUED"===e?"Waiting":"IN_PROGRESS"===e?"In Progress":"DONE"===e?"Done":"—"}function er(e){return"QUEUED"===e?"bg-pink-100 text-pink-700 border-pink-200":"IN_PROGRESS"===e?"bg-yellow-100 text-yellow-800 border-yellow-200":"DONE"===e?"bg-green-100 text-green-700 border-green-200":"bg-gray-100 text-gray-700 border-gray-200"}function el(e){let{visitId:i,patientId:u,patientName:x,patientPhone:m,patientSdId:p,opdNo:g,doctorName:f,visitDateLabel:v,visitStatus:y,onRevisionModeChange:j}=e,D=(0,a.useRouter)(),T=(0,c.useGetMeQuery)(),k=T.data?.doctorProfile?.fullName??T.data?.displayName??void 0,O=T.data?.doctorProfile?.registrationNumber,R=(0,s.useMemo)(()=>f&&!Z(f)?f:k&&!Z(k)?k:void 0,[f,k]),L=(0,s.useMemo)(()=>{if(O)return`B.D.S Regd. - ${O}`},[O]),B=(0,c.useGetVisitByIdQuery)(i,{skip:!i}),A=(0,c.useGetPatientByIdQuery)(u??"",{skip:!u}),E=B.data?.status??y,P=(0,s.useMemo)(()=>{let e=B.data;return q(W(e)?e.createdAt:void 0)},[B.data]),U=(0,s.useMemo)(()=>P?`Visit: ${(0,b.clinicDateISO)(P)}`:v??"",[P,v]),$=(0,s.useMemo)(()=>{let e=A.data,t=W(e)?e:{},s=String(t.sex??t.gender??t.patientSex??"").trim().toUpperCase();return"M"===s||"F"===s||"O"===s||"U"===s?s:"MALE"===s?"M":"FEMALE"===s?"F":"OTHER"===s?"O":void 0},[A.data]),X=(0,s.useMemo)(()=>{let e=A.data,t=W(e)?e:{},s=q(t.dob??t.dateOfBirth??t.birthDate??t.dobIso??null),a=P??new Date;if(s)return J(s,a)},[A.data,P]),[G,z]=(0,s.useState)([]),[H,el]=(0,s.useState)([]),[ed,eo]=(0,s.useState)(""),[ec,eu]=(0,s.useState)("idle"),[,ex]=(0,s.useState)(null),em=(0,s.useRef)(!1),ep=(0,s.useRef)(""),eh=(0,s.useRef)(null),eg=(0,c.useGetVisitRxQuery)({visitId:i},{skip:!i}),[ef]=(0,c.useUpsertVisitRxMutation)(),[ev,ey]=(0,c.useStartVisitRxRevisionMutation)(),[eb,ej]=(0,s.useState)(!1),eN="DONE"===E,ew=!eN||eb,[eI,eC]=(0,s.useState)(!1);(0,s.useEffect)(()=>{if(em.current||!eg.isSuccess)return;let e=eg.data?.rx??null,t=W(e)?e:{},s=t.toothDetails,a=t.doctorNotes;e?(z(e.lines??[]),el(Array.isArray(s)?s:[]),eo("string"==typeof a?a:""),ex(e.rxId),ep.current=JSON.stringify({lines:e.lines??[],toothDetails:Array.isArray(s)?s:[],doctorNotes:"string"==typeof a?a:""})):(z([]),el([]),eo(""),ex(null),ep.current=JSON.stringify({lines:[],toothDetails:[],doctorNotes:""})),em.current=!0,eu("idle")},[eg.isSuccess,eg.data]);let eS=(0,s.useMemo)(()=>JSON.stringify({lines:G,toothDetails:H,doctorNotes:ed}),[G,H,ed]),eM=G.length>0||H.length>0,eD=ew&&em.current&&eM&&eS!==ep.current;(0,s.useEffect)(()=>{if(eD)return eh.current&&clearTimeout(eh.current),eh.current=setTimeout(async()=>{eu("saving");try{let e=await ef({visitId:i,lines:G,toothDetails:H,doctorNotes:ed}).unwrap();ex(e.rxId),ep.current=eS,eu("saved")}catch{eu("error")}},900),()=>{eh.current&&clearTimeout(eh.current)}},[eD,eS,G,H,ed,i,ef]);let eT=ew&&em.current&&(G.length>0||H.length>0),ek=async()=>{if(eT){eu("saving");try{let e=await ef({visitId:i,lines:G,toothDetails:H,doctorNotes:ed}).unwrap();ex(e.rxId),ep.current=eS,eu("saved"),D.push("/doctor")}catch{eu("error")}}},eO=(0,c.useGetPatientVisitsQuery)(u??"",{skip:!u}),eR=eO.data?.items??[],eL=B.data,eB=(0,s.useMemo)(()=>{if(!u)return{visitIds:[i],meta:new Map,currentVisitId:i};let e=new Map;for(let t of eR)e.set(t.visitId,t);eL&&e.set(eL.visitId,eL);let t=W(eL)?eL:{},s=_(t.tag),a=_(t.anchorVisitId),n="F"===s?a:i;if(!n)return{visitIds:[i],meta:e,currentVisitId:i};let r=[],l=e.get(n);for(let t of(l&&r.push(l),e.values())){let e=_((W(t)?t:{}).anchorVisitId);e&&e===n&&t.visitId!==n&&r.push(t)}if(!r.some(e=>e.visitId===i)){let t=e.get(i);t?r.push(t):r.push({visitId:i})}r.sort((e,t)=>(e.createdAt??e.updatedAt??0)-(t.createdAt??t.updatedAt??0));let d=new Set;return{visitIds:r.map(e=>e.visitId).filter(e=>!d.has(e)&&(d.add(e),!0)),meta:e,currentVisitId:i}},[u,i,eR,eL]),eA=(0,s.useMemo)(()=>[...eR].filter(e=>"DONE"===e.status).sort((e,t)=>(t.updatedAt??t.createdAt??0)-(e.updatedAt??e.createdAt??0)),[eR]),[eE,eP]=(0,s.useState)(!1),[eU,eV]=(0,s.useState)(void 0),eF=(0,s.useMemo)(()=>eU?(0,b.clinicDateISO)(eU):null,[eU]),e$=(0,s.useMemo)(()=>eF?eA.filter(e=>e.visitDate===eF):eA,[eA,eF]),eX=(0,s.useMemo)(()=>{let e=new Map;for(let t of eA)e.set(t.visitId,t);return e},[eA]),eG=(0,s.useMemo)(()=>{let e=new Map,t=[];for(let t of e$)et(t)||e.set(t.visitId,{anchor:t,followups:[]});for(let s of e$){let a=et(s);if(!a)continue;let i=e.get(a);i?i.followups.push(s):t.push(s)}for(let t of e.values())t.followups.sort((e,t)=>(e.createdAt??0)-(t.createdAt??0));return{anchorsOrdered:Array.from(e.values()).sort((e,t)=>(t.anchor.updatedAt??t.anchor.createdAt??0)-(e.anchor.updatedAt??e.anchor.createdAt??0)),orphanGroups:t.sort((e,t)=>(t.updatedAt??t.createdAt??0)-(e.updatedAt??e.createdAt??0)).map(e=>({followup:e}))}},[e$,eX]),[ez,eH]=(0,s.useState)(1);(0,s.useEffect)(()=>eH(1),[eF,eR]);let eQ=Math.min(ez,Math.max(1,Math.ceil(eG.anchorsOrdered.length/2))),eW=(0,s.useMemo)(()=>{let e=(eQ-1)*2;return eG.anchorsOrdered.slice(e,e+2)},[eG.anchorsOrdered,eQ]),e_=eF??"Pick a date",eq=e=>{D.push(`/doctor/visits/${e.visitId}`)},[eJ,eZ]=(0,s.useState)(!1),[eK,eY]=(0,s.useState)(!1),[e0,e1]=(0,s.useState)(null),e2=e=>{e1(e),eZ(!0)},e4=e=>{e1(e),eY(!0)},e5=(e,s)=>{let a,i,n,r=0;if("NEW"===s.kind){let t=e.visitId;for(let e of eA)et(e)===t&&(r+=1)}let l="FOLLOWUP"===s.kind?(a=s.anchor??(et(e)?eX.get(et(e)):void 0),i=(a?.reason||"—").toString(),n=a?.visitDate?(0,b.formatClinicDateShort)(a.visitDate):"—",`Follow-up of: ${i} • ${n}`):null;return(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("div",{className:"truncate text-sm font-semibold text-gray-900",children:e.reason?.trim()?e.reason:"—"}),(0,t.jsx)("div",{className:"mt-0.5 text-[11px] text-gray-500",children:"NEW"===s.kind?(0,t.jsx)("span",{className:"inline-flex items-center gap-2",children:(0,t.jsxs)("span",{className:"rounded-md bg-gray-50 px-2 py-0.5 text-gray-600 shadow-[0_0_0_1px_rgba(0,0,0,0.04)]",children:[r," follow-up",1===r?"":"s"]})}):(0,t.jsx)("span",{className:"truncate",children:l})})]})},e6=eW.length>0||eG.orphanGroups.length>0;return(0,t.jsxs)("div",{className:"relative w-full min-w-0",children:[(0,t.jsxs)("div",{className:"grid w-full min-w-0 grid-cols-1 gap-4 lg:grid-cols-10",children:[(0,t.jsxs)("div",{className:"min-w-0 rounded-2xl bg-white p-4 lg:col-span-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("div",{className:"text-lg font-semibold text-gray-900",children:"Prescription"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"text-[11px] text-gray-500",children:"saving"===ec?"Saving…":"saved"===ec?"Saved":"error"===ec?"Save failed":""}),eN&&!eb?(0,t.jsx)(r.Button,{variant:"outline",className:"rounded-xl",disabled:ey.isLoading,onClick:async()=>{try{let e=await ev({visitId:i}).unwrap();ex(e.rxId),ej(!0),j?.(!0),eu("idle")}catch{eu("error")}},children:"Start Revision"}):null,(0,t.jsx)(r.Button,{variant:"outline",className:"rounded-xl",onClick:ek,disabled:!eT||"saving"===ec,title:eT?"Save prescription and return":"Add medicines or tooth details to save",children:"Save"})]})]}),(0,t.jsxs)("div",{className:"mt-4 rounded-2xl border bg-white p-4 ",children:[(0,t.jsx)("div",{className:"text-base font-semibold text-gray-900",children:"Doctor Notes"}),(0,t.jsx)("div",{className:"mt-1 text-sm text-gray-500",children:"Internal note from doctor for reception. This will NOT print."}),(0,t.jsx)("textarea",{className:"mt-3 w-full min-h-22.5 rounded-2xl border bg-gray-50 p-3 text-sm outline-none focus:bg-white",placeholder:"—",value:ed,onChange:e=>eo(e.target.value),disabled:!ew})]}),(0,t.jsx)("div",{className:"mt-4 min-w-full overflow-x-hidden flex justify-center items-center",children:(0,t.jsx)(d.PrescriptionPreview,{patientName:x,patientPhone:m,patientAge:X,patientSex:$,sdId:p,opdNo:g,doctorName:R,doctorRegdLabel:L,visitDateLabel:U,lines:G,currentVisitId:eB.currentVisitId,chainVisitIds:eB.visitIds,visitMetaMap:eB.meta,toothDetails:H})})]}),(0,t.jsxs)(n.Card,{className:"w-full min-w-0 rounded-2xl border bg-white p-4 lg:col-span-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between border-b pb-3",children:[(0,t.jsx)("div",{className:"text-lg font-semibold text-gray-900",children:"Medicines"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[ew?(0,t.jsx)(h,{visitId:i,variant:"outline"}):null,(0,t.jsx)(r.Button,{type:"button",variant:"outline",className:"rounded-xl",disabled:!ew,onClick:()=>eC(!0),children:"Import Preset"})]})]}),(0,t.jsx)("div",{className:"mt-3",children:ew?(0,t.jsx)(N,{visitId:i,variant:"embedded",canDelete:!0}):(0,t.jsx)(w.XrayTrayReadOnly,{visitId:i})}),(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsx)(Q,{value:H,onChange:el,disabled:!ew})}),(0,t.jsx)("div",{className:"mt-4 min-w-0",children:ew?(0,t.jsx)(o.MedicinesEditor,{lines:G,onChange:z}):(0,t.jsx)(K,{lines:G})})]}),(0,t.jsxs)(n.Card,{className:"w-full rounded-2xl border bg-white p-4 lg:col-span-10",children:[(0,t.jsx)("div",{className:"flex items-center justify-between gap-3",children:(0,t.jsxs)(I.Popover,{open:eE,onOpenChange:eP,children:[(0,t.jsx)(I.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)(r.Button,{type:"button",variant:"outline",className:"w-55 justify-start gap-2 rounded-xl",children:[(0,t.jsx)(F.Calendar,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:eF?"text-gray-900":"text-gray-500",children:e_})]})}),(0,t.jsxs)(I.PopoverContent,{align:"start",className:"w-auto rounded-2xl p-2",children:[(0,t.jsx)(C.Calendar,{mode:"single",selected:eU,onSelect:e=>{eV(e),eP(!1)}}),eF?(0,t.jsx)("div",{className:"px-2 pb-2 pt-1",children:(0,t.jsx)(r.Button,{type:"button",variant:"ghost",className:"h-8 rounded-xl text-xs",onClick:()=>{eV(void 0),eP(!1)},children:"Clear"})}):null]})]})}),(0,t.jsxs)("div",{className:"mt-4 overflow-hidden rounded-2xl border",children:[(0,t.jsxs)(M.Table,{children:[(0,t.jsx)(M.TableHeader,{children:(0,t.jsxs)(M.TableRow,{className:"bg-gray-50",children:[(0,t.jsx)(M.TableHead,{className:"font-semibold text-gray-600",children:"Visit Date"}),(0,t.jsx)(M.TableHead,{className:"font-semibold text-gray-600",children:"Reason"}),(0,t.jsx)(M.TableHead,{className:"font-semibold text-gray-600",children:"Type"}),(0,t.jsx)(M.TableHead,{className:"font-semibold text-gray-600",children:"Stage"}),(0,t.jsx)(M.TableHead,{className:"text-right font-semibold text-gray-600",children:"Actions"})]})}),(0,t.jsx)(M.TableBody,{children:u?eO.isLoading?(0,t.jsx)(M.TableRow,{children:(0,t.jsx)(M.TableCell,{colSpan:5,className:"py-10 text-center text-sm text-gray-500",children:"Loading visits…"})}):e6?(0,t.jsxs)(t.Fragment,{children:[eW.map(e=>{let a=e.anchor,i=e.followups;return(0,t.jsxs)(s.default.Fragment,{children:[(0,t.jsxs)(M.TableRow,{className:"hover:bg-gray-50/60",children:[(0,t.jsx)(M.TableCell,{className:"px-6 py-4 align-top text-sm font-medium text-gray-900",children:(0,b.formatClinicDateShort)(a.visitDate)}),(0,t.jsx)(M.TableCell,{className:"px-6 py-4 align-top",children:e5(a,{kind:"NEW"})}),(0,t.jsx)(M.TableCell,{className:"px-6 py-4 align-top",children:(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsx)(l.Badge,{variant:"outline",className:`rounded-full px-4 py-1 text-[11px] font-semibold ${ea("NEW")}`,children:"NEW"}),es(a)?(0,t.jsx)(l.Badge,{variant:"outline",className:`rounded-full px-4 py-1 text-[11px] font-semibold ${ei()}`,children:"ZERO BILLED"}):null]})}),(0,t.jsx)(M.TableCell,{className:"px-6 py-4 align-top",children:(0,t.jsx)(l.Badge,{variant:"outline",className:`rounded-full px-4 py-1 text-xs font-semibold ${er(a.status)}`,children:en(a.status)})}),(0,t.jsx)(M.TableCell,{className:"px-6 py-4 align-top text-right",children:(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,t.jsx)(r.Button,{type:"button",variant:"outline",className:"h-8 rounded-xl px-3 text-xs",onClick:()=>e2(a.visitId),children:"View Rx"}),(0,t.jsx)(r.Button,{type:"button",variant:"outline",className:"h-8 rounded-xl px-3 text-xs",onClick:()=>e4(a.visitId),children:"X-rays"}),(0,t.jsx)(r.Button,{type:"button",variant:"outline",className:"h-8 rounded-xl px-3 text-xs",onClick:()=>eq(a),children:"View"})]})})]}),i.map(e=>(0,t.jsxs)(M.TableRow,{className:"hover:bg-gray-50/60",children:[(0,t.jsx)(M.TableCell,{className:"px-6 py-2 align-top",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"ml-1 h-7 w-0.5 rounded-full bg-gray-200"}),(0,t.jsx)("div",{className:"text-sm text-gray-900",children:(0,b.formatClinicDateShort)(e.visitDate)})]})}),(0,t.jsx)(M.TableCell,{className:"px-6 py-2 align-top",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"ml-1 h-7 w-0.5 rounded-full bg-gray-200"}),(0,t.jsx)("div",{className:"min-w-0 flex-1",children:e5(e,{kind:"FOLLOWUP",anchor:a})})]})}),(0,t.jsx)(M.TableCell,{className:"px-6 py-2 align-top",children:(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsx)(l.Badge,{variant:"outline",className:`rounded-full px-4 py-1 text-[11px] font-semibold ${ea("FOLLOWUP")}`,children:"FOLLOW UP"}),es(e)?(0,t.jsx)(l.Badge,{variant:"outline",className:`rounded-full px-4 py-1 text-[11px] font-semibold ${ei()}`,children:"ZERO BILLED"}):null]})}),(0,t.jsx)(M.TableCell,{className:"px-6 py-2 align-top",children:(0,t.jsx)(l.Badge,{variant:"outline",className:`rounded-full px-4 py-1 text-xs font-semibold ${er(e.status)}`,children:en(e.status)})}),(0,t.jsx)(M.TableCell,{className:"px-6 py-2 align-top text-right",children:(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,t.jsx)(r.Button,{type:"button",variant:"outline",className:"h-8 rounded-xl px-3 text-xs",onClick:()=>e2(e.visitId),children:"View Rx"}),(0,t.jsx)(r.Button,{type:"button",variant:"outline",className:"h-8 rounded-xl px-3 text-xs",onClick:()=>e4(e.visitId),children:"X-rays"}),(0,t.jsx)(r.Button,{type:"button",variant:"outline",className:"h-8 rounded-xl px-3 text-xs",onClick:()=>eq(e),children:"View"})]})})]},e.visitId))]},a.visitId)}),eG.orphanGroups.length?eG.orphanGroups.map(({followup:e})=>{let s=et(e),a=s?eX.get(s):void 0;return(0,t.jsxs)(M.TableRow,{className:"hover:bg-gray-50/60",children:[(0,t.jsx)(M.TableCell,{className:"px-6 py-3 align-top text-sm text-gray-900",children:(0,b.formatClinicDateShort)(e.visitDate)}),(0,t.jsx)(M.TableCell,{className:"px-6 py-3 align-top",children:e5(e,{kind:"FOLLOWUP",anchor:a})}),(0,t.jsx)(M.TableCell,{className:"px-6 py-3 align-top",children:(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsx)(l.Badge,{variant:"outline",className:`rounded-full px-4 py-1 text-[11px] font-semibold ${ea("FOLLOWUP")}`,children:"FOLLOW UP"}),es(e)?(0,t.jsx)(l.Badge,{variant:"outline",className:`rounded-full px-4 py-1 text-[11px] font-semibold ${ei()}`,children:"ZERO BILLED"}):null]})}),(0,t.jsx)(M.TableCell,{className:"px-6 py-3 align-top",children:(0,t.jsx)(l.Badge,{variant:"outline",className:`rounded-full px-4 py-1 text-xs font-semibold ${er(e.status)}`,children:en(e.status)})}),(0,t.jsx)(M.TableCell,{className:"px-6 py-3 align-top text-right",children:(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,t.jsx)(r.Button,{type:"button",variant:"outline",className:"h-8 rounded-xl px-3 text-xs",onClick:()=>e2(e.visitId),children:"View Rx"}),(0,t.jsx)(r.Button,{type:"button",variant:"outline",className:"h-8 rounded-xl px-3 text-xs",onClick:()=>e4(e.visitId),children:"X-rays"}),(0,t.jsx)(r.Button,{type:"button",variant:"outline",className:"h-8 rounded-xl px-3 text-xs",onClick:()=>eq(e),children:"View"})]})})]},e.visitId)}):null]}):(0,t.jsx)(M.TableRow,{children:(0,t.jsxs)(M.TableCell,{colSpan:5,className:"py-10 text-center text-sm text-gray-500",children:["No visits found",eF?` for ${eF}`:"","."]})}):(0,t.jsx)(M.TableRow,{children:(0,t.jsx)(M.TableCell,{colSpan:5,className:"py-10 text-center text-sm text-gray-500",children:"Loading patient context…"})})})]}),eG.anchorsOrdered.length>2?(0,t.jsx)("div",{className:"border-t bg-white px-3 py-2",children:(0,t.jsx)(V,{page:eQ,pageSize:2,totalItems:eG.anchorsOrdered.length,onPageChange:eH})}):null]})]})]}),(0,t.jsx)(S.RxPresetImportDialog,{open:eI,onOpenChange:eC,disabled:!ew,append:!0,existingCount:G.length,onImport:e=>{z(t=>[...t,...e])}}),(0,t.jsx)(Y,{open:eJ,onOpenChange:e=>eZ(e),visitId:e0,patientId:u,patientName:x,patientPhone:m,patientSdId:p,opdNo:g,doctorName:R,doctorRegdLabel:L}),(0,t.jsx)(ee,{open:eK,onOpenChange:e=>eY(e),visitId:e0})]})}function ed(e){return"object"==typeof e&&null!==e}function eo(){let e=(0,a.useParams)(),n=(0,a.useRouter)(),l=(0,s.useMemo)(()=>String(e?.visitId??""),[e?.visitId]),d=(0,c.useGetVisitByIdQuery)(l,{skip:!l}),o=d.data?.patientId,u=(0,c.useGetPatientByIdQuery)(o??"",{skip:!o}),[x,m]=(0,c.useUpdateVisitStatusMutation)(),p=d.data?.status,h="DONE"===p,[g,f]=(0,s.useState)(!1),v=!!l&&("IN_PROGRESS"===p||"QUEUED"===p)&&!m.isLoading,y=async()=>{if(l)try{await x({visitId:l,status:"DONE",date:d.data?.visitDate}).unwrap(),i.toast.success("Session ended. Visit marked as DONE."),n.push("/doctor")}catch(e){i.toast.error(function(e){if(e instanceof Error&&e.message)return e.message;if(ed(e)){let t=e.data;if(ed(t)&&"string"==typeof t.message&&t.message.trim())return t.message;if("string"==typeof e.message&&e.message.trim())return e.message}return"Failed to end session."}(e))}},b=(0,s.useMemo)(()=>{let e=d.data;if(!ed(e))return;let t=e.opdNo;return"string"==typeof t?t:void 0},[d.data]);return(0,t.jsxs)("div",{className:"p-4 2xl:p-8",children:[(0,t.jsxs)("div",{className:"mb-4 flex items-center justify-end gap-3",children:[h?null:(0,t.jsx)(r.Button,{type:"button",variant:"outline",className:"rounded-xl",disabled:!0,children:"Hold Session"}),(0,t.jsx)(r.Button,{type:"button",className:"rounded-xl bg-black text-white hover:bg-black/90",disabled:h?!g:!v,onClick:()=>{h?(f(!1),i.toast.success("Revision ended.")):y()},children:m.isLoading?"Ending…":h?"End Revision":"End Session"})]}),(0,t.jsx)(el,{visitId:l,patientId:o,patientName:u.data?.name,patientPhone:u.data?.phone,patientSdId:u.data?.sdId,opdNo:b,visitStatus:p,onRevisionModeChange:f})]})}e.s(["default",()=>eo],14154)}]);