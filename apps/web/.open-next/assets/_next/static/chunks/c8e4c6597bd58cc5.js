(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,57154,e=>{"use strict";var t=e.i(43476);let i=["UL","UR","LL","LR"];function s({toothDetails:e,className:s}){let r=(e??[]).map(e=>({...e,toothNumbers:(e.toothNumbers??[]).map(e=>String(e).trim()).filter(Boolean),notes:e.notes?.trim()||void 0})),l=r.some(e=>(e.toothNumbers?.length??0)>0),n=r.some(e=>!!e.notes);if(!l&&!n)return null;let a=function(e){let t=new Map;for(let e of i)t.set(e,[]);for(let i of e){let e=function(e){let t=String(e??"").trim().toUpperCase();return"UL"===t||"UR"===t||"LL"===t||"LR"===t?t:null}(i.position);if(!e)continue;let s=t.get(e)??[];s.push(...(i.toothNumbers??[]).map(e=>String(e).trim()).filter(Boolean)),t.set(e,s)}for(let e of i){let i=Array.from(new Set(t.get(e)??[]));i.sort((e,t)=>e.localeCompare(t)),t.set(e,i)}return t}(r),d=Array.from(new Set(r.map(e=>e.notes).filter(Boolean))),o=1===d.length?d[0]:null;return(0,t.jsxs)("div",{className:["flex items-start gap-3",s??""].join(" "),children:[(0,t.jsx)("div",{className:"relative shrink-0",children:(0,t.jsxs)("div",{className:"grid h-11 w-20.5 grid-cols-2 rounded-md bg-white overflow-hidden",children:[(0,t.jsx)("div",{className:"flex items-center justify-center border-b border-r border-gray-700 px-1",children:(0,t.jsx)("div",{className:"line-clamp-1 text-[12px] font-semibold text-gray-900",children:(a.get("UL")??[]).join(", ")||"—"})}),(0,t.jsx)("div",{className:"flex items-center justify-center border-b border-gray-700 px-1",children:(0,t.jsx)("div",{className:"line-clamp-1 text-[12px] font-semibold text-gray-900",children:(a.get("UR")??[]).join(", ")||"—"})}),(0,t.jsx)("div",{className:"flex items-center justify-center border-r border-gray-700 px-1",children:(0,t.jsx)("div",{className:"line-clamp-1 text-[12px] font-semibold text-gray-900",children:(a.get("LL")??[]).join(", ")||"—"})}),(0,t.jsx)("div",{className:"flex items-center justify-center px-1",children:(0,t.jsx)("div",{className:"line-clamp-1 text-[12px] font-semibold text-gray-900",children:(a.get("LR")??[]).join(", ")||"—"})})]})}),(0,t.jsx)("div",{className:"min-w-0 flex-1",children:o?(0,t.jsx)("div",{className:"truncate text-[12px] font-semibold text-gray-900",children:o}):d.length?(0,t.jsx)("div",{className:"space-y-1",children:d.map((e,i)=>(0,t.jsx)("div",{className:"truncate text-[12px] font-semibold text-gray-900",children:e},i))}):(0,t.jsx)("div",{className:"text-[12px] text-gray-500",children:"—"})})]})}e.s(["ToothDetailsBlock",()=>s])},46762,e=>{"use strict";var t=e.i(43476),i=e.i(71645),s=e.i(74080),r=e.i(57688),l=e.i(70931),n=e.i(32595),a=e.i(57154);let d={QD:"Once Daily",BID:"Twice Daily",TID:"Thrice Daily",QID:"Four Times Daily",HS:"At Bedtime",PRN:"As Needed"},o={BEFORE_MEAL:"before food",AFTER_MEAL:"after food",ANY:""};function c(e){let t=[],i=[e.medicine,e.dose].filter(Boolean).join(" ").trim();i&&t.push(i);let s=[e.frequency?`${e.frequency}(${d[e.frequency]})`:"",e.timing?o[e.timing]:""].filter(Boolean).join(" ").trim();return s&&t.push(`- ${s}`),"number"==typeof e.duration&&e.duration>0&&t.push(`For ${e.duration} days.`),e.notes?.trim()&&t.push(e.notes.trim()),t.join(" ")}function x(e,t){if("object"==typeof e&&null!==e)return e[t]}function m(e,t){let i=x(e,t);if(null!=i){if("string"==typeof i)return i;if("number"==typeof i||"boolean"==typeof i)return String(i)}}function u(e){if(!e)return;let t=function(e,t){for(let i of t){let t=x(e,i);if(void 0!==t)return t}}(e,["opdNo","opdNumber","opdId","opd","opd_no","opd_no_str"]);if(null!=t)return String(t).trim()||void 0}function h(e){let{visitId:i,isCurrent:s,currentLines:r,visit:d,showOpdInline:o,opdInlineText:x,currentToothDetails:u}=e,h=(0,l.useGetVisitRxQuery)({visitId:i},{skip:s||!i}),p=s?r:h.data?.rx?.lines??[],f=s?u:h.data?.rx?.toothDetails??[],g=m(d,"visitDate"),v=m(d,"reason"),N=(f?.length??0)>0;return p.length||v||g||N?(0,t.jsxs)("div",{className:`rx-block ${s?"rx-block-current":"rx-block-prev"}`,children:[(0,t.jsxs)("div",{className:"rx-block-meta mb-2 flex items-baseline justify-between",children:[(0,t.jsx)("div",{className:"text-[12px] font-bold text-gray-900",children:g?(0,n.formatClinicDateShort)(g):"—"}),(0,t.jsxs)("div",{className:"ml-4 flex min-w-0 flex-1 items-baseline justify-end gap-3",children:[(0,t.jsx)("div",{className:"min-w-0 flex-1 truncate text-right text-[11px] font-medium text-gray-700",children:v?.trim()?v.trim():""}),o&&x?(0,t.jsx)("div",{className:"shrink-0 text-right text-[11px] font-semibold text-gray-900",children:x}):null]})]}),N?(0,t.jsx)("div",{className:"mb-2",children:(0,t.jsx)(a.ToothDetailsBlock,{toothDetails:f})}):null,p.length?(0,t.jsx)("ol",{className:"space-y-1 text-[13px] leading-5 text-gray-900",children:p.map((e,i)=>(0,t.jsxs)("li",{className:"flex gap-2",children:[(0,t.jsxs)("div",{className:"w-5 shrink-0 text-right font-medium",children:[i+1,"."]}),(0,t.jsx)("div",{className:"font-medium",children:c(e)})]},i))}):(0,t.jsx)("div",{className:"text-[12px] text-gray-500",children:"No medicines recorded."}),(0,t.jsx)("div",{className:"rx-block-sep mt-3 h-px w-full bg-gray-200"})]}):(0,t.jsx)("div",{className:"h-2 rx-block rx-block-prev"})}function p(e){let l,n,{patientName:d,patientPhone:o,patientAge:x,patientSex:m,sdId:p,opdNo:f,visitDateLabel:g,lines:v,receptionNotes:N,currentVisitId:j,chainVisitIds:y,visitMetaMap:b,toothDetails:w}=e,[D,S]=(0,i.useState)(!1);(0,i.useEffect)(()=>S(!0),[]);let M=!!N?.trim(),k=(l="number"==typeof x?Number.isFinite(x)&&x>0?String(x):"":(x??"").toString().trim(),n=(m??"").toString().trim().toUpperCase(),l||n?l&&n?`${l}/${n}`:l||n||"—":"—"),A=(0,i.useMemo)(()=>j??"CURRENT",[j]),R=(0,i.useMemo)(()=>y&&y.length?y:[A],[y,A]),I=(0,i.useMemo)(()=>b??new Map,[b]),L=!!j&&!!y&&y.length>0&&!!b,T=(0,i.useMemo)(()=>{if(L)return R[0]},[L,R]),B=(0,i.useMemo)(()=>{if(L&&T){let e=u(I.get(T));if(e)return e}return f??"—"},[L,T,I,f]),C=(0,i.useMemo)(()=>w??[],[w]),P=!L&&C.length>0;return D?(0,s.createPortal)((0,t.jsxs)("div",{className:"rx-print-root",children:[(0,t.jsx)("style",{children:`
        .rx-print-root { display: none; }

        @media print {
          body.print-rx > *:not(.rx-print-root) { display: none !important; }
          body.print-rx .rx-print-root { display: block !important; }

          @page { size: A4; margin: 0; }

          html, body {
            margin: 0 !important;
            padding: 0 !important;
            background: #fff !important;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
          }

          .rx-a4 {
            width: 210mm;
            height: 297mm;
            margin: 0 auto;
            padding: 8mm;
            box-sizing: border-box;
            background: white;
          }

          body.print-rx.print-rx-current-only .rx-print-header,
          body.print-rx.print-rx-current-only .rx-print-doctor,
          body.print-rx.print-rx-current-only .rx-print-patient,
          body.print-rx.print-rx-current-only .rx-print-sep-top,
          body.print-rx.print-rx-current-only .rx-print-sep-mid {
            visibility: hidden !important;
          }

          body.print-rx.print-rx-current-only .rx-print-notes {
            display: none !important;
          }

          body.print-rx.print-rx-current-only .rx-block-prev {
            visibility: hidden !important;
          }
        }
      `}),(0,t.jsx)("div",{className:"rx-a4 text-black",children:(0,t.jsxs)("div",{className:"flex h-full flex-col",children:[(0,t.jsx)("div",{className:"rx-print-header shrink-0 px-10",children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,t.jsx)("div",{className:"relative h-20 w-20",children:(0,t.jsx)(r.default,{src:"/rx-logo-r.png",alt:"Rx Logo",fill:!0,className:"object-contain",priority:!0,unoptimized:!0})}),(0,t.jsxs)("div",{className:"mt-2 flex w-full flex-col items-center justify-center text-center",children:[(0,t.jsx)("div",{className:"text-[12px] font-semibold tracking-[0.25em] text-emerald-600",children:"CONTACT"}),(0,t.jsx)("div",{className:"mt-1 text-[14px] font-semibold text-gray-900",children:"9938942846"}),(0,t.jsx)("div",{className:"mt-1 max-w-[120mm] text-[9px] font-medium leading-4 text-gray-800",children:"A-33, STALWART COMPLEX, UNIT - IV, BHUBANESWAR"}),(0,t.jsx)("div",{className:"max-w-[120mm] text-[9px] font-medium leading-4 text-red-400 uppercase",children:"Clinic hours: 10 : 00 AM - 01 : 30 PM & 06 : 00 PM - 08:00 PM, Sunday Closed"})]}),(0,t.jsx)("div",{className:"relative h-18 w-42",children:(0,t.jsx)(r.default,{src:"/dashboard-logo.png",alt:"Sarangi Dentistry",fill:!0,className:"object-contain",priority:!0,unoptimized:!0})})]})}),(0,t.jsx)("div",{className:"rx-print-sep-top mt-2 h-px w-full bg-emerald-600/60"}),(0,t.jsx)("div",{className:"rx-print-doctor shrink-0 px-4 pt-3",children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-6",children:[(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("div",{className:"text-[12px] font-bold text-gray-900",children:"Dr. Soumendra Sarangi"}),(0,t.jsx)("div",{className:"mt-0.5 text-[11px] font-light text-gray-700",children:"B.D.S. Regd. - 68"})]}),(0,t.jsxs)("div",{className:"flex flex-col items-end text-right",children:[(0,t.jsx)("div",{className:"text-[12px] font-bold text-gray-900",children:"Dr. Vaishnovee Sarangi"}),(0,t.jsx)("div",{className:"mt-0.5 text-[11px] font-light text-gray-700",children:"B.D.S. Redg. - 3057"})]})]})}),(0,t.jsx)("div",{className:"rx-print-patient shrink-0 px-4 pt-2",children:(0,t.jsxs)("div",{className:"mt-1 flex w-full justify-between gap-6",children:[(0,t.jsxs)("div",{className:"space-y-1 text-[11px] text-gray-800",children:[(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("div",{className:"w-28 text-gray-600",children:"Patient Name"}),(0,t.jsx)("div",{className:"text-gray-600",children:":"}),(0,t.jsx)("div",{className:"font-semibold text-gray-900",children:d??"—"})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("div",{className:"w-28 text-gray-600",children:"Contact No."}),(0,t.jsx)("div",{className:"text-gray-600",children:":"}),(0,t.jsx)("div",{className:"font-semibold text-gray-900",children:o??"—"})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("div",{className:"w-28 text-gray-600",children:"Age/Sex"}),(0,t.jsx)("div",{className:"text-gray-600",children:":"}),(0,t.jsx)("div",{className:"font-semibold text-gray-900",children:k})]})]}),(0,t.jsxs)("div",{className:"space-y-1 text-[11px] text-gray-800",children:[(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("div",{className:"w-28 text-gray-600",children:"Regd. Date"}),(0,t.jsx)("div",{className:"text-gray-600",children:":"}),(0,t.jsx)("div",{className:"font-semibold text-gray-900",children:g?.replace("Visit:","").trim()||"—"})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("div",{className:"w-28 text-gray-600",children:"SD. ID"}),(0,t.jsx)("div",{className:"text-gray-600",children:":"}),(0,t.jsx)("div",{className:"font-semibold text-gray-900",children:p??"—"})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("div",{className:"w-28 text-gray-600",children:"OPD. No"}),(0,t.jsx)("div",{className:"text-gray-600",children:":"}),(0,t.jsx)("div",{className:"font-semibold text-gray-900",children:B})]})]})]})}),(0,t.jsx)("div",{className:"rx-print-sep-mid mt-3 h-px w-full bg-gray-900/30"}),(0,t.jsx)("div",{className:"rx-print-medicines min-h-0 flex-1 pt-4",children:L?(0,t.jsx)("div",{className:"space-y-4",children:R.map(e=>{let i=I.get(e),s=null!=T&&e===T,r=s?void 0:u(i);return(0,t.jsx)(h,{visitId:"CURRENT"===e?"":e,isCurrent:e===A,currentLines:v,visit:i,showOpdInline:!s,opdInlineText:r,currentToothDetails:C},e)})}):(0,t.jsxs)("div",{className:"px-4",children:[P?(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)(a.ToothDetailsBlock,{toothDetails:C}),(0,t.jsx)("div",{className:"mt-3 h-px w-full bg-gray-200"})]}):null,v.length?(0,t.jsx)("ol",{className:"space-y-1 text-[13px] leading-5 text-gray-900",children:v.map((e,i)=>(0,t.jsxs)("li",{className:"flex gap-2",children:[(0,t.jsxs)("div",{className:"w-5 shrink-0 text-right font-medium",children:[i+1,"."]}),(0,t.jsx)("div",{className:"font-medium",children:c(e)})]},i))}):(0,t.jsx)("div",{className:"text-[12px] text-gray-500",children:"No medicines recorded."}),(0,t.jsx)("div",{className:"mt-3 h-px w-full bg-gray-200"})]})}),M?(0,t.jsx)("div",{className:"rx-print-notes shrink-0 pb-2",children:(0,t.jsxs)("div",{className:"mt-3 rounded-xl border border-gray-200 bg-gray-50 px-3 py-2",children:[(0,t.jsx)("div",{className:"text-[11px] font-semibold text-gray-700",children:"Reception Notes"}),(0,t.jsx)("div",{className:"mt-1 whitespace-pre-wrap text-[12px] leading-5 text-gray-900",children:N})]})}):null]})})]}),document.body):null}e.s(["PrescriptionPrintSheet",()=>p])},85449,e=>{"use strict";var t=e.i(43476),i=e.i(71645),s=e.i(57688),r=e.i(32595),l=e.i(70931),n=e.i(57154);let a={QD:"Once Daily",BID:"Twice Daily",TID:"Thrice Daily",QID:"Four Times Daily",HS:"At Bedtime",PRN:"As Needed"},d={BEFORE_MEAL:"before food",AFTER_MEAL:"After food",ANY:""};function o(e){let t=[],i=[e.medicine,e.dose].filter(Boolean).join(" ").trim();i&&t.push(i);let s=[e.frequency?`${e.frequency}(${a[e.frequency]})`:"",e.timing?d[e.timing]:""].filter(Boolean).join(" ").trim();return s&&t.push(`- ${s}`),"number"==typeof e.duration&&e.duration>0&&t.push(`For ${e.duration} days.`),e.notes?.trim()&&t.push(e.notes.trim()),t.join(" ")}function c(e,t){if("object"==typeof e&&null!==e)return e[t]}function x(e,t){let i=c(e,t);if(null!=i){if("string"==typeof i)return i;if("number"==typeof i||"boolean"==typeof i)return String(i)}}function m(e){if(!e)return;let t=function(e,t){for(let i of t){let t=c(e,i);if(void 0!==t)return t}}(e,["opdNo","opdNumber","opdId","opd","opd_no","opd_no_str"]);if(null!=t)return String(t).trim()||void 0}function u(e){let{visitId:i,isCurrent:s,currentLines:a,visit:d,showOpdInline:c,opdInlineText:m,currentToothDetails:u}=e,h=(0,l.useGetVisitRxQuery)({visitId:i},{skip:s||!i}),p=s?a:h.data?.rx?.lines??[],f=s?u:h.data?.rx?.toothDetails??[],g=x(d,"visitDate"),v=x(d,"reason"),N=(f?.length??0)>0;return p.length||v||g||N?(0,t.jsxs)("div",{className:"rx-prev-block",children:[(0,t.jsxs)("div",{className:"mb-2 flex items-baseline justify-between",children:[(0,t.jsx)("div",{className:"text-[12px] font-bold text-gray-900",children:g?(0,r.formatClinicDateShort)(g):"—"}),(0,t.jsxs)("div",{className:"ml-4 flex min-w-0 flex-1 items-baseline justify-end gap-3",children:[(0,t.jsx)("div",{className:"min-w-0 flex-1 truncate text-right text-[11px] font-medium text-gray-700",children:v?.trim()?v.trim():""}),c&&m?(0,t.jsx)("div",{className:"shrink-0 text-right text-[11px] font-semibold text-gray-900",children:m}):null]})]}),N?(0,t.jsx)("div",{className:"mb-2",children:(0,t.jsx)(n.ToothDetailsBlock,{toothDetails:f})}):null,0===p.length?(0,t.jsx)("div",{className:"text-[12px] text-gray-500",children:"No medicines recorded."}):(0,t.jsx)("ol",{className:"space-y-1 text-[13px] leading-5 text-gray-900",children:p.map((e,i)=>(0,t.jsxs)("li",{className:"flex gap-2",children:[(0,t.jsxs)("div",{className:"w-5 shrink-0 text-right font-medium",children:[i+1,"."]}),(0,t.jsx)("div",{className:"font-medium",children:o(e)})]},i))}),(0,t.jsx)("div",{className:"mt-3 h-px w-full bg-gray-200"})]}):(0,t.jsx)("div",{className:"h-2"})}function h(e){let{page:i,total:s,onChange:r}=e;if(s<=1)return null;let l=(e,t)=>["h-8 min-w-8 rounded-lg border px-2 text-xs font-semibold transition",t?"opacity-50 cursor-not-allowed":"",e?"bg-black text-white border-black":"bg-white text-gray-800 hover:bg-gray-50"].join(" ");return(0,t.jsxs)("div",{className:"mt-3 flex items-center justify-center gap-2",children:[(0,t.jsx)("button",{type:"button",className:l(!1,i<=1),onClick:()=>r(Math.max(1,i-1)),disabled:i<=1,children:"Prev"}),Array.from({length:s},(e,t)=>t+1).map(e=>(0,t.jsx)("button",{type:"button",className:l(e===i),onClick:()=>r(e),title:`Page ${e}`,children:e},e)),(0,t.jsx)("button",{type:"button",className:l(!1,i>=s),onClick:()=>r(Math.min(s,i+1)),disabled:i>=s,children:"Next"})]})}function p({patientName:e,patientPhone:l,patientAge:a,patientSex:d,sdId:c,opdNo:x,visitDateLabel:p,lines:f,receptionNotes:g,currentVisitId:v,chainVisitIds:N,visitMetaMap:j,toothDetails:y,currentOnly:b=!1}){let w,D,S=!!g?.trim(),M=(w="number"==typeof a?Number.isFinite(a)&&a>0?String(a):"":(a??"").toString().trim(),D=(d??"").toString().trim().toUpperCase(),w||D?w&&D?`${w}/${D}`:w||D||"—":"—"),k=(0,i.useMemo)(()=>(function(e){if(!e)return null;let t=e.trim().startsWith("Visit:")?e.replace("Visit:","").trim():e.trim();return/^\d{4}-\d{2}-\d{2}$/.test(t)?t:null})(p)??(0,r.clinicDateISO)(new Date),[p]),A=(0,i.useMemo)(()=>v??"CURRENT",[v]),R=(0,i.useMemo)(()=>{let e=(N&&N.length?[...N]:[A]).filter(Boolean);A&&!e.includes(A)&&e.push(A);let t=new Set;return e.filter(e=>!t.has(e)&&(t.add(e),!0))},[N,A]),I=(0,i.useMemo)(()=>j??new Map,[j]),L=!!v&&!!N&&N.length>0&&!!j,T=(0,i.useMemo)(()=>{if(L)return R[0]},[L,R]),B=(0,i.useMemo)(()=>{if(L&&T){let e=m(I.get(T));if(e)return e}return x??"—"},[L,T,I,x]),C=Math.round(225720/210),P=(0,i.useRef)(null),[F,E]=(0,i.useState)(1);(0,i.useEffect)(()=>{let e=P.current;if(!e)return;let t=new ResizeObserver(e=>{let t=Math.min(1,(e[0]?.contentRect?.width??760)/760);E(Number.isFinite(t)&&t>0?t:1)});return t.observe(e),()=>t.disconnect()},[]);let O=(0,i.useMemo)(()=>y??[],[y]),V=!L&&O.length>0,U=(0,i.useRef)(null),$=(0,i.useRef)(null),q=(0,i.useRef)(null),Q=(0,i.useRef)(null),[_,z]=(0,i.useState)([]),[H,G]=(0,i.useState)(560),[W,Y]=(0,i.useState)(980),[K,X]=(0,i.useState)(0),[J,Z]=(0,i.useState)([R]),[ee,et]=(0,i.useState)(1),ei=(0,i.useMemo)(()=>[L?"H":"N",R.join(","),String(f.length),String(O.length),String(g?.length??0)].join("|"),[L,R,f.length,O.length,g]),es=L&&R.length>1;(0,i.useEffect)(()=>{b||et(1)},[b,L,R.join("|")]),(0,i.useEffect)(()=>{if(!es)return void Z([R]);let e=U.current;if(!e)return;let t=()=>{if($.current){let e=$.current.getBoundingClientRect().height;Number.isFinite(e)&&e>0&&G(Math.floor(e))}if(q.current){let e=q.current.getBoundingClientRect().height;Number.isFinite(e)&&e>0&&Y(Math.floor(e))}if(Q.current){let e=Q.current.getBoundingClientRect().height;X(Number.isFinite(e)&&e>0?Math.ceil(e):0)}z(Array.from(e.querySelectorAll('[data-rx-block="1"]')).map(e=>{let t=Math.ceil(e.getBoundingClientRect().height),i=window.getComputedStyle(e);return Math.ceil(t+(Number.parseFloat(i.marginTop||"0")||0)+(Number.parseFloat(i.marginBottom||"0")||0))}))};t(),requestAnimationFrame(()=>t()),document.fonts?.ready&&document.fonts.ready.then(()=>requestAnimationFrame(()=>t()));let i=new ResizeObserver(()=>t());return i.observe(e),()=>i.disconnect()},[es,ei]),(0,i.useEffect)(()=>{if(!L||!es||!_.length||_.length!==R.length)return void Z([R]);let e=[];{let t=[],i=0,s=H;for(let r=0;r<R.length;r++){let l=R[r],n=_[r]??0;t.length>0&&i+n>s-10&&(e.push(t),t=[],i=0,s=W),t.push(l),i+=n}t.length&&e.push(t),e.length||(e=[R])}let t=e=>{let t=R.indexOf(e);return t>=0?_[t]??0:0},i=e=>e.reduce((e,i)=>e+t(i),0);for(let s=0;s<3;s++){for(let s=0;s<e.length-1;s++){let r=0===s?H:W;for(;e[s+1].length>0;){let l=e[s+1][0],n=t(l);if(i(e[s])+n<=r-10)e[s].push(l),e[s+1].shift();else break}}(e=e.filter(e=>e.length>0)).length||(e=[R])}if(S&&K>0&&e.length>0){let t=e.length-1,s=(0===t?H:W)-K;if(i(e[t])>s-10&&e[t].length>1){let i=e[t].pop();i&&e.push([i])}}Z(e)},[L,es,R,_,H,W,S,K]),(0,i.useEffect)(()=>{if(!L||!b||!J.length)return;let e=J.findIndex(e=>e.includes(A));e>=0&&et(e+1)},[b,L,J,A]),(0,i.useEffect)(()=>{let e=J.length||1;ee>e&&et(e),ee<1&&et(1)},[J.length,ee]);let er=J.length||1,el=J[Math.max(0,ee-1)]??R,en=b?{visibility:"hidden"}:void 0,ea=()=>S?(0,t.jsx)("div",{className:"shrink-0 px-6 pb-2",children:(0,t.jsxs)("div",{className:"rounded-xl border border-gray-200 bg-gray-50 px-3 py-2",children:[(0,t.jsx)("div",{className:"text-[10px] font-semibold text-gray-700",children:"Reception Notes"}),(0,t.jsx)("div",{className:"mt-1 whitespace-pre-wrap text-[10px] leading-4 text-gray-900",children:g})]})}):null,ed=S&&ee===er&&!b,eo=1===ee,ec=e=>(0,t.jsx)("div",{className:"space-y-4",children:e.map(e=>{let i=I.get(e),s=null!=T&&e===T,r=s?void 0:m(i),l=e===A;return(0,t.jsx)("div",{"data-rx-block":"1",style:b&&!l?{visibility:"hidden"}:void 0,children:(0,t.jsx)(u,{visitId:"CURRENT"===e?"":e,isCurrent:l,currentLines:f,visit:i,showOpdInline:!s,opdInlineText:r,currentToothDetails:O})},e)})}),ex=es?(0,t.jsx)("div",{"aria-hidden":"true",className:"pointer-events-none fixed left-0 top-0",style:{width:0,height:0,overflow:"hidden",opacity:0},children:(0,t.jsx)("div",{style:{width:760},children:(0,t.jsxs)("div",{ref:U,className:"w-full",children:[(0,t.jsx)("div",{className:"h-[1080px] w-full overflow-hidden border bg-white",children:(0,t.jsxs)("div",{className:"flex h-full flex-col",children:[(0,t.jsxs)("div",{className:"shrink-0 px-6 pt-4",children:[(0,t.jsx)("div",{className:"h-16 w-full"}),(0,t.jsx)("div",{className:"mt-2 h-px w-full"})]}),(0,t.jsxs)("div",{className:"shrink-0 px-6 pt-3",children:[(0,t.jsx)("div",{className:"h-24 w-full"}),(0,t.jsx)("div",{className:"mt-3 h-px w-full"})]}),(0,t.jsx)("div",{className:"min-h-0 flex-1 px-6 pt-4 pb-4",children:(0,t.jsx)("div",{ref:$,className:"h-full w-full"})}),(0,t.jsx)("div",{className:"shrink-0 px-6 pb-2",children:(0,t.jsx)("div",{ref:Q,className:"w-full",children:ea()})})]})}),(0,t.jsx)("div",{className:"mt-8 h-[1080px] w-full overflow-hidden border bg-white",children:(0,t.jsx)("div",{className:"flex h-full flex-col",children:(0,t.jsx)("div",{className:"min-h-0 flex-1 px-6 pt-6 pb-4",children:(0,t.jsx)("div",{ref:q,className:"h-full w-full"})})})}),(0,t.jsx)("div",{className:"mt-8 px-6 pt-4",children:ec(R)})]})})}):null;return(0,t.jsxs)("div",{className:"w-full",children:[ex,(0,t.jsxs)("div",{ref:P,className:"w-full",children:[(0,t.jsx)("div",{className:"relative w-full",style:{height:Math.ceil(C*F)},children:(0,t.jsx)("div",{className:"origin-top-left",style:{width:760,height:C,transform:`scale(${F})`},children:(0,t.jsx)("div",{className:"h-full w-full overflow-hidden rounded-xl border bg-white shadow-sm",children:eo?(0,t.jsxs)("div",{className:"flex h-full flex-col",children:[(0,t.jsxs)("div",{className:"shrink-0 px-6 pt-4",style:en,children:[(0,t.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,t.jsx)("div",{className:"relative h-16 w-16",children:(0,t.jsx)(s.default,{src:"/rx-logo-r.png",alt:"Rx Logo",fill:!0,className:"object-contain",priority:!0,unoptimized:!0})}),(0,t.jsxs)("div",{className:"mt-1 flex w-full flex-col items-center justify-center text-center",children:[(0,t.jsx)("div",{className:"text-[10px] font-semibold tracking-[0.30em] text-emerald-600",children:"CONTACT"}),(0,t.jsx)("div",{className:"text-[12px] font-semibold text-gray-900",children:"9938942846"}),(0,t.jsx)("div",{className:"mt-1 max-w-130 text-[9px] font-medium leading-4 text-gray-700",children:"A-33, STALWART COMPLEX, UNIT - IV, BHUBANESWAR"}),(0,t.jsx)("div",{className:"max-w-130 text-[9px] font-medium leading-4 text-red-400 uppercase",children:"Clinic hours: 10 : 00 AM - 01 : 30 PM & 06 : 00 PM - 08:00 PM, Sunday Closed"})]}),(0,t.jsx)("div",{className:"relative h-14 w-38",children:(0,t.jsx)(s.default,{src:"/dashboard-logo.png",alt:"Sarangi Dentistry",fill:!0,className:"object-contain",priority:!0,unoptimized:!0})})]}),(0,t.jsx)("div",{className:"mt-2 h-px w-full bg-emerald-600/60"})]}),(0,t.jsxs)("div",{className:"shrink-0 px-6 pt-3",style:en,children:[(0,t.jsxs)("div",{className:"flex items-start justify-between gap-6",children:[(0,t.jsxs)("div",{className:"min-w-0 flex flex-col",children:[(0,t.jsx)("div",{className:"text-[0.8rem] font-bold text-gray-900",children:"Dr. Soumendra Sarangi"}),(0,t.jsx)("div",{className:"mt-0 text-[0.7rem] font-light text-gray-700",children:"B.D.S. Regd. - 68"})]}),(0,t.jsxs)("div",{className:"min-w-0 flex flex-col items-end text-right",children:[(0,t.jsx)("div",{className:"text-[0.8rem] font-bold text-gray-900",children:"Dr. Vaishnovee Sarangi"}),(0,t.jsx)("div",{className:"mt-0 text-[0.7rem] font-light text-gray-700",children:"B.D.S. Redg. - 3057"})]})]}),(0,t.jsxs)("div",{className:"mt-2 flex w-full justify-between gap-6",children:[(0,t.jsxs)("div",{className:"space-y-0.5 text-[0.8rem] text-gray-800",children:[(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("div",{className:"w-20 text-gray-600",children:"Patient Name"}),(0,t.jsx)("div",{className:"text-gray-600",children:":"}),(0,t.jsx)("div",{className:"font-semibold text-gray-900",children:e??"—"})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("div",{className:"w-20 text-gray-600",children:"Contact No."}),(0,t.jsx)("div",{className:"text-gray-600",children:":"}),(0,t.jsx)("div",{className:"font-semibold text-gray-900",children:l??"—"})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("div",{className:"w-20 text-gray-600",children:"Age/Sex"}),(0,t.jsx)("div",{className:"text-gray-600",children:":"}),(0,t.jsx)("div",{className:"font-semibold text-gray-900",children:M})]})]}),(0,t.jsxs)("div",{className:"w-[320px] justify-start space-y-0 text-[0.8rem]",children:[(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("div",{className:"w-20 text-gray-600",children:"Regd. Date"}),(0,t.jsx)("div",{className:"text-gray-600",children:":"}),(0,t.jsx)("div",{className:"font-semibold text-gray-900",children:k})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("div",{className:"w-20 text-gray-600",children:"SD. ID"}),(0,t.jsx)("div",{className:"text-gray-600",children:":"}),(0,t.jsx)("div",{className:"font-semibold text-gray-900",children:c??"—"})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("div",{className:"w-20 text-gray-600",children:"OPD. No"}),(0,t.jsx)("div",{className:"text-gray-600",children:":"}),(0,t.jsx)("div",{className:"font-semibold text-gray-900",children:B})]})]})]}),(0,t.jsx)("div",{className:"mt-3 h-px w-full bg-gray-900/30"})]}),(0,t.jsx)("div",{className:"min-h-0 flex-1 px-6 pt-4 pb-4",children:L?ec(el):(0,t.jsxs)(t.Fragment,{children:[V?(0,t.jsxs)("div",{className:"mb-3",children:[(0,t.jsx)(n.ToothDetailsBlock,{toothDetails:O}),(0,t.jsx)("div",{className:"mt-3 h-px w-full bg-gray-200"})]}):null,0===f.length?(0,t.jsx)("div",{className:"text-[13px] text-gray-500",children:"No medicines added yet."}):(0,t.jsx)("ol",{className:"text-sm leading-6 text-gray-900",children:f.map((e,i)=>(0,t.jsxs)("li",{className:"flex gap-1",children:[(0,t.jsxs)("div",{className:"w-4 shrink-0 text-right font-medium",children:[i+1,"."]}),(0,t.jsx)("div",{className:"font-medium",children:o(e)})]},i))})]})}),ed?ea():null]}):(0,t.jsxs)("div",{className:"flex h-full flex-col",children:[(0,t.jsx)("div",{className:"min-h-0 flex-1 px-6 pt-6 pb-4",children:L?ec(el):null}),ed?ea():null]})})})}),L&&!b?(0,t.jsx)(h,{page:ee,total:er,onChange:et}):null]})]})}e.s(["PrescriptionPreview",()=>p])},49138,e=>{"use strict";var t=e.i(43476),i=e.i(71645),s=e.i(18566),r=e.i(66691),l=e.i(70317),n=e.i(85449),a=e.i(46762),d=e.i(70931);function o(e){return"object"==typeof e&&null!==e}function c(e){return"string"==typeof e&&e.trim()?e:void 0}function x(e){if(!o(e))return!1;let t=e.position,i=e.toothNumbers,s=Array.isArray(i)&&i.every(e=>"string"==typeof e),r=void 0===e.notes||"string"==typeof e.notes;return("UL"===t||"UR"===t||"LL"===t||"LR"===t)&&s&&r}function m(){var e,m,u;let h,p,f,g,v,N=(0,s.useParams)(),j=(0,s.useRouter)(),y=String(N?.visitId??""),b=(0,d.useGetVisitByIdQuery)(y,{skip:!y}).data,w=o(b)?b:{},D=c(w.patientId),S=(0,d.useGetPatientByIdQuery)(D??"",{skip:!D}),M=(0,d.useGetVisitRxQuery)({visitId:y},{skip:!y}),k=M.data?.rx??null,A=(0,d.useGetDoctorsQuery)(void 0),R=(0,d.useGetPatientVisitsQuery)(D??"",{skip:!D}),I=R.data?.items??[],L=S.data?.name,T=S.data?.phone,B=o(S.data)?S.data:{},C=c(B.sdId)??c(w.sdId)??void 0,P=c(w.opdNo)??c(w.opdId)??c(w.opdNumber)??void 0,F=B.dob??B.dateOfBirth??B.birthDate??B.dobIso??null,E=B.sex??B.gender??B.patientSex??null,O=function(e){if(!e)return null;if("number"==typeof e&&Number.isFinite(e)){let t=new Date(e);return Number.isFinite(t.getTime())?t:null}if("string"==typeof e){let t=e.trim();if(!t)return null;let i=/^(\d{4})-(\d{2})-(\d{2})$/.exec(t);if(i){let e=new Date(Number(i[1]),Number(i[2])-1,Number(i[3]));return Number.isFinite(e.getTime())?e:null}let s=new Date(t);return Number.isFinite(s.getTime())?s:null}return e instanceof Date&&Number.isFinite(e.getTime())?e:null}(F),V=("number"==typeof(e=w.createdAt)&&Number.isFinite(e)?e:void 0)??Date.now(),U=O?(h=(m=new Date(V)).getFullYear()-O.getFullYear(),((p=m.getMonth()-O.getMonth())<0||0===p&&m.getDate()<O.getDate())&&(h-=1),h<0?0:h):void 0,$=function(e){if(!e)return;let t=String(e).trim().toUpperCase();return"M"===t||"MALE"===t?"M":"F"===t||"FEMALE"===t?"F":"O"===t||"OTHER"===t?"O":"U"===t||"UNKNOWN"===t?"U":"M"===t||"F"===t||"O"===t||"U"===t?t:void 0}(E),q=c(w.doctorId),Q=i.useMemo(()=>{let e=A.data??[];return q?(Array.isArray(e)?e:[]).find(e=>o(e)&&c(e.doctorId)===q)??null:null},[A.data,q]),_=o(Q)?Q:{},z=c(_.fullName)??c(_.name)??c(_.displayName)??void 0,H=c(_.registrationNumber)??void 0,G=i.useMemo(()=>z&&!function(e){if(!e)return!0;let t=e.trim();return!!(!t||/^Doctor\s*\(.+\)$/i.test(t)||/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(t))}(z)?z:A.isLoading||A.isFetching?void 0:q?`Doctor (${q})`:void 0,[z,A.isLoading,A.isFetching,q]),W=i.useMemo(()=>{if(H)return`B.D.S Regd. - ${H}`;A.isLoading||A.isFetching},[H,A.isLoading,A.isFetching]),Y=V?`Visit: ${f=(u=new Date(V)).getFullYear(),g=String(u.getMonth()+1).padStart(2,"0"),v=String(u.getDate()).padStart(2,"0"),`${f}-${g}-${v}`}`:void 0,[K,X]=i.useState(!0),J=i.useMemo(()=>{let e=new Map;for(let t of I)e.set(t.visitId,t);let t=o(b)?c(w.visitId):void 0;t&&e.set(t,b);let i=o(b)?c(w.tag):void 0,s=o(b)?c(w.anchorVisitId):void 0,r="F"===i?s:y;if(!r)return{visitIds:[y],meta:e,currentVisitId:y};let l=e.get(r),n=[];l&&n.push(l);let a=[];for(let t of e.values()){let e=c(t?.anchorVisitId);e&&e===r&&t.visitId!==r&&a.push(t)}if(a.sort((e,t)=>(e.createdAt??e.updatedAt??0)-(t.createdAt??t.updatedAt??0)),n.push(...a),!n.some(e=>e.visitId===y)){let t=e.get(y);n.push(t??{visitId:y})}n.sort((e,t)=>(e.createdAt??e.updatedAt??0)-(t.createdAt??t.updatedAt??0));let d=new Set,x=n.map(e=>e.visitId).filter(e=>!(!e||d.has(e))&&(d.add(e),!0)),m=x.indexOf(y);return{visitIds:m>=0?x.slice(0,m+1):[y],meta:e,currentVisitId:y}},[I,b,y,w]),Z=i.useMemo(()=>{var e;return Array.isArray(e=(o(k)?k:{}).toothDetails)?e.filter(x):[]},[k]),ee=(k?.lines?.length??0)>0,et=Z.length>0,ei=ee||et,es=!K;return(0,t.jsxs)("section",{className:"p-4 2xl:p-8",children:[(0,t.jsxs)("div",{className:"mb-4 flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,t.jsx)("div",{children:(0,t.jsx)("div",{className:"text-lg font-semibold text-gray-900",children:"Prescription Print Preview"})}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center justify-end gap-2",children:[(0,t.jsx)(r.Button,{type:"button",variant:"outline",className:"rounded-xl cursor-pointer",onClick:()=>j.back(),children:"Back"}),(0,t.jsx)(r.Button,{variant:"outline",className:"rounded-xl cursor-pointer",disabled:!ei,onClick:()=>X(e=>!e),title:"Toggle printing previous visit blocks",children:K?"Print: History ON":"Print: Current only"}),(0,t.jsx)(r.Button,{variant:"default",className:"rounded-xl bg-black text-white hover:bg-black/90 cursor-pointer",onClick:()=>{if(!ei)return;let e=()=>{document.body.classList.remove("print-rx"),document.body.classList.remove("print-rx-current-only"),window.removeEventListener("afterprint",e)};window.addEventListener("afterprint",e),document.body.classList.add("print-rx"),K||document.body.classList.add("print-rx-current-only"),requestAnimationFrame(()=>{requestAnimationFrame(()=>window.print())})},disabled:!ei,title:ei?"Print prescription":"No medicines or tooth details to print",children:"Print"})]})]}),(0,t.jsxs)(l.Card,{className:"rounded-2xl border bg-white p-4",children:[(0,t.jsx)("div",{className:"text-sm font-semibold text-gray-900",children:"Preview"}),(0,t.jsx)("div",{className:"rx-preview-shell mt-3 min-w-0 overflow-x-hidden",children:(0,t.jsx)(n.PrescriptionPreview,{patientName:L,patientPhone:T,patientAge:U,patientSex:$,sdId:C,opdNo:P,doctorName:G,doctorRegdLabel:W,visitDateLabel:Y,lines:k?.lines??[],currentVisitId:J.currentVisitId,chainVisitIds:J.visitIds,visitMetaMap:J.meta,toothDetails:Z,receptionNotes:es?void 0:k?.receptionNotes??"",currentOnly:es})})]}),(0,t.jsx)(a.PrescriptionPrintSheet,{patientName:L,patientPhone:T,patientAge:U,patientSex:$,sdId:C,opdNo:P,doctorName:G,doctorRegdLabel:W,visitDateLabel:Y,lines:k?.lines??[],receptionNotes:k?.receptionNotes??"",currentVisitId:J.currentVisitId,chainVisitIds:J.visitIds,visitMetaMap:J.meta,printWithHistory:K,toothDetails:Z})]})}e.s(["default",()=>m])}]);