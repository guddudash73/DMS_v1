(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,46349,e=>{"use strict";let t=(0,e.i(75254).default)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);e.s(["default",()=>t])},34164,29978,33565,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(9797);let l=(0,e.i(75254).default)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);e.s(["ChevronLeftIcon",()=>l],29978);var n=e.i(46349);e.s(["ChevronRightIcon",()=>n.default],33565);var n=n,s=e.i(97791),d=e.i(75760),o=e.i(52236),i=e.i(66691);function c({className:e,classNames:a,showOutsideDays:c=!0,captionLayout:p="label",buttonVariant:m="ghost",formatters:h,components:x,...f}){let g=(0,d.getDefaultClassNames)();return(0,t.jsx)(s.DayPicker,{showOutsideDays:c,className:(0,o.cn)("bg-background group/calendar p-3 [--cell-size:--spacing(8)] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent",String.raw`rtl:**:[.rdp-button\_next>svg]:rotate-180`,String.raw`rtl:**:[.rdp-button\_previous>svg]:rotate-180`,e),captionLayout:p,formatters:{formatMonthDropdown:e=>e.toLocaleString("default",{month:"short"}),...h},classNames:{root:(0,o.cn)("w-fit",g.root),months:(0,o.cn)("flex gap-4 flex-col md:flex-row relative",g.months),month:(0,o.cn)("flex flex-col w-full gap-4",g.month),nav:(0,o.cn)("flex items-center gap-1 w-full absolute top-0 inset-x-0 justify-between",g.nav),button_previous:(0,o.cn)((0,i.buttonVariants)({variant:m}),"size-(--cell-size) aria-disabled:opacity-50 p-0 select-none",g.button_previous),button_next:(0,o.cn)((0,i.buttonVariants)({variant:m}),"size-(--cell-size) aria-disabled:opacity-50 p-0 select-none",g.button_next),month_caption:(0,o.cn)("flex items-center justify-center h-(--cell-size) w-full px-(--cell-size)",g.month_caption),dropdowns:(0,o.cn)("w-full flex items-center text-sm font-medium justify-center h-(--cell-size) gap-1.5",g.dropdowns),dropdown_root:(0,o.cn)("relative has-focus:border-ring border border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] rounded-md",g.dropdown_root),dropdown:(0,o.cn)("absolute bg-popover inset-0 opacity-0",g.dropdown),caption_label:(0,o.cn)("select-none font-medium","label"===p?"text-sm":"rounded-md pl-2 pr-1 flex items-center gap-1 text-sm h-8 [&>svg]:text-muted-foreground [&>svg]:size-3.5",g.caption_label),table:"w-full border-collapse",weekdays:(0,o.cn)("flex",g.weekdays),weekday:(0,o.cn)("text-muted-foreground rounded-md flex-1 font-normal text-[0.8rem] select-none",g.weekday),week:(0,o.cn)("flex w-full mt-2",g.week),week_number_header:(0,o.cn)("select-none w-(--cell-size)",g.week_number_header),week_number:(0,o.cn)("text-[0.8rem] select-none text-muted-foreground",g.week_number),day:(0,o.cn)("relative w-full h-full p-0 text-center [&:last-child[data-selected=true]_button]:rounded-r-md group/day aspect-square select-none",f.showWeekNumber?"[&:nth-child(2)[data-selected=true]_button]:rounded-l-md":"[&:first-child[data-selected=true]_button]:rounded-l-md",g.day),range_start:(0,o.cn)("rounded-l-md bg-accent",g.range_start),range_middle:(0,o.cn)("rounded-none",g.range_middle),range_end:(0,o.cn)("rounded-r-md bg-accent",g.range_end),today:(0,o.cn)("bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none",g.today),outside:(0,o.cn)("text-muted-foreground aria-selected:text-muted-foreground",g.outside),disabled:(0,o.cn)("text-muted-foreground opacity-50",g.disabled),hidden:(0,o.cn)("invisible",g.hidden),...a},components:{Root:({className:e,rootRef:a,...r})=>(0,t.jsx)("div",{"data-slot":"calendar",ref:a,className:(0,o.cn)(e),...r}),Chevron:({className:e,orientation:a,...s})=>"left"===a?(0,t.jsx)(l,{className:(0,o.cn)("size-4",e),...s}):"right"===a?(0,t.jsx)(n.default,{className:(0,o.cn)("size-4",e),...s}):(0,t.jsx)(r.ChevronDownIcon,{className:(0,o.cn)("size-4",e),...s}),DayButton:u,WeekNumber:({children:e,...a})=>(0,t.jsx)("td",{...a,children:(0,t.jsx)("div",{className:"flex size-(--cell-size) items-center justify-center text-center",children:e})}),...x},...f})}function u({className:e,day:r,modifiers:l,...n}){let s=(0,d.getDefaultClassNames)(),c=a.useRef(null);return a.useEffect(()=>{l.focused&&c.current?.focus()},[l.focused]),(0,t.jsx)(i.Button,{ref:c,variant:"ghost",size:"icon","data-day":r.date.toLocaleDateString(),"data-selected-single":l.selected&&!l.range_start&&!l.range_end&&!l.range_middle,"data-range-start":l.range_start,"data-range-end":l.range_end,"data-range-middle":l.range_middle,className:(0,o.cn)("data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 dark:hover:text-accent-foreground flex aspect-square size-auto w-full min-w-(--cell-size) flex-col gap-1 leading-none font-normal group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] data-[range-end=true]:rounded-md data-[range-end=true]:rounded-r-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md data-[range-start=true]:rounded-l-md [&>span]:text-xs [&>span]:opacity-70",s.day,e),...n})}e.s(["Calendar",()=>c,"CalendarDayButton",()=>u],34164)},7064,e=>{"use strict";var t=e.i(43476),a=e.i(52236);function r({className:e,...r}){return(0,t.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,t.jsx)("table",{"data-slot":"table",className:(0,a.cn)("w-full caption-bottom text-sm",e),...r})})}function l({className:e,...r}){return(0,t.jsx)("thead",{"data-slot":"table-header",className:(0,a.cn)("[&_tr]:border-b",e),...r})}function n({className:e,...r}){return(0,t.jsx)("tbody",{"data-slot":"table-body",className:(0,a.cn)("[&_tr:last-child]:border-0",e),...r})}function s({className:e,...r}){return(0,t.jsx)("tr",{"data-slot":"table-row",className:(0,a.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",e),...r})}function d({className:e,...r}){return(0,t.jsx)("th",{"data-slot":"table-head",className:(0,a.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...r})}function o({className:e,...r}){return(0,t.jsx)("td",{"data-slot":"table-cell",className:(0,a.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...r})}e.s(["Table",()=>r,"TableBody",()=>n,"TableCell",()=>o,"TableHead",()=>d,"TableHeader",()=>l,"TableRow",()=>s])},74886,e=>{"use strict";let t=(0,e.i(75254).default)("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);e.s(["Copy",()=>t],74886)},95468,e=>{"use strict";let t=(0,e.i(75254).default)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);e.s(["CheckCircle2",()=>t],95468)},54990,e=>{"use strict";var t=e.i(43476),a=e.i(71645),r=e.i(22016),l=e.i(18566),n=e.i(70319),s=e.i(87316),d=e.i(75254);let o=(0,d.default)("phone-call",[["path",{d:"M13 2a9 9 0 0 1 9 9",key:"1itnx2"}],["path",{d:"M13 6a5 5 0 0 1 5 5",key:"11nki7"}],["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]]);var i=e.i(74886),c=e.i(95468);let u=(0,d.default)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var p=e.i(70317),m=e.i(66691),h=e.i(69262),x=e.i(34164),f=e.i(7064),g=e.i(50106),b=e.i(70931),w=e.i(32595);function y(e){if("object"!=typeof e||null===e)return null;let t=e.message;return"string"==typeof t&&t.trim().length>0?t:null}function v({status:e}){return"COMPLETED"===e?(0,t.jsx)("span",{className:"inline-flex items-center rounded-full bg-emerald-50 px-2 py-0.5 text-[11px] font-semibold text-emerald-700",children:"Done"}):"CANCELLED"===e?(0,t.jsx)("span",{className:"inline-flex items-center rounded-full bg-rose-50 px-2 py-0.5 text-[11px] font-semibold text-rose-700",children:"Cancelled"}):(0,t.jsx)("span",{className:"inline-flex items-center rounded-full bg-amber-50 px-2 py-0.5 text-[11px] font-semibold text-amber-700",children:"Active"})}function j(){let e=(0,l.useRouter)(),d=(0,l.useSearchParams)(),j=(0,g.useAuth)(),N="authenticated"===j.status&&!!j.accessToken,[C,k]=(0,a.useState)(()=>new Date),T=(0,a.useMemo)(()=>(0,w.clinicDateISO)(C),[C]),[_,S]=(0,a.useState)(!1),z=(0,b.useGetDailyFollowupsQuery)(T,{skip:!N}),[D,P]=(0,a.useState)({}),[I,A]=(0,a.useState)([]),[L,M]=(0,a.useState)({});(0,a.useEffect)(()=>{let e=z.data?.items??[];0!==e.length&&(M(t=>{let a={...t};for(let t of e)a[t.followupId]=t;return a}),A(t=>{let a=new Set(t),r=[...t];for(let t of e)a.has(t.followupId)||(r.push(t.followupId),a.add(t.followupId));return r}))},[z.data?.items]);let E=(0,a.useMemo)(()=>{let e=z.data?.items??[],t=new Set(e.map(e=>e.followupId)),a=[...e];for(let e of I){if(t.has(e))continue;let r=L[e];r&&r.followUpDate===T&&a.push(r)}return a.map(e=>{let t=D[e.followupId];return t?{...e,status:t}:e})},[z.data?.items,I,L,D,T]),[R,B]=(0,b.useUpdateFollowupStatusMutation)(),[H,F]=(0,b.useCreateVisitFollowupMutation)(),O=(0,a.useRef)(!1);(0,a.useEffect)(()=>{if(!N||O.current)return;let t=d.get("mode"),a=d.get("visitId"),r=d.get("date"),l=d.get("contact"),s=d.get("reason");if("add"!==t||!a||!r)return;if(!/^\d{4}-\d{2}-\d{2}$/.test(r))return void n.toast.error("Invalid follow-up date in URL.");let o=function(e){if(!/^\d{4}-\d{2}-\d{2}$/.test(e))return null;let[t,a,r]=e.split("-").map(e=>Number(e));return new Date(t,a-1,r,0,0,0,0)}(r);o&&k(o),O.current=!0;let i="CALL"===l||"SMS"===l||"WHATSAPP"===l?l:void 0;(async()=>{try{let t=await H({visitId:a,followUpDate:r,reason:s?.trim()||void 0,contactMethod:i}).unwrap();n.toast.success("Follow-up added"),M(e=>({...e,[t.followupId]:t})),A(e=>e.includes(t.followupId)?e:[...e,t.followupId]);let l=new URLSearchParams(d.toString());l.delete("mode"),l.delete("visitId"),l.delete("date"),l.delete("contact"),l.delete("reason"),l.delete("enabled");let o=l.toString();e.replace(o?`/reminders?${o}`:"/reminders")}catch(t){let e=y(t.data)??y(t)??"Failed to add follow-up";n.toast.error(e)}})()},[N,d,H,e]);let U=async(e,t)=>{if(!N)return void n.toast.error("Session not ready. Please re-login.");P(e=>({...e,[t]:"COMPLETED"}));try{await R({visitId:e,followupId:t,status:"COMPLETED",dateTag:T}).unwrap(),n.toast.success("Marked as completed")}catch(a){P(e=>{let a={...e};return delete a[t],a});let e=y(a.data)??y(a)??"Failed to update";n.toast.error(e)}},$=async(e,t)=>{if(!N)return void n.toast.error("Session not ready. Please re-login.");P(e=>({...e,[t]:"CANCELLED"}));try{await R({visitId:e,followupId:t,status:"CANCELLED",dateTag:T}).unwrap(),n.toast.success("Cancelled")}catch(a){P(e=>{let a={...e};return delete a[t],a});let e=y(a.data)??y(a)??"Failed to update";n.toast.error(e)}},V=`WBC / Reminder Calls — ${T}`,W=(()=>{if(!z.isError)return null;let e=z.error;return e?.status===401?"Not authorized. Please login again.":"Failed to load reminders."})();return(0,t.jsx)("div",{className:"relative p-4 2xl:p-8",children:(0,t.jsxs)(p.Card,{className:"h-full w-full rounded-2xl border bg-white p-4 shadow-none",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3 border-b pb-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-lg font-semibold text-gray-900",children:V}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:N?F.isLoading?"Adding follow-up…":z.isFetching?"Refreshing…":`${E.length} reminder(s)`:"Checking session…"})]}),(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsxs)(h.Popover,{open:_,onOpenChange:S,children:[(0,t.jsx)(h.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)(m.Button,{type:"button",variant:"outline",className:"w-55 justify-start gap-2 rounded-xl cursor-pointer",disabled:!N,children:[(0,t.jsx)(s.Calendar,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"text-gray-900",children:T})]})}),(0,t.jsx)(h.PopoverContent,{align:"end",className:"w-auto rounded-2xl p-2",children:(0,t.jsx)(x.Calendar,{mode:"single",selected:C,onSelect:e=>{e&&(k(e),S(!1))}})})]})})]}),(0,t.jsx)("div",{className:"mt-4 h-[calc(100%-64px)] overflow-hidden rounded-2xl border",children:(0,t.jsxs)("div",{className:"h-full overflow-y-auto dms-scroll bg-white",children:[W&&(0,t.jsx)("div",{className:"border-b bg-red-50 px-4 py-2 text-sm text-red-700",children:W}),(0,t.jsxs)(f.Table,{children:[(0,t.jsx)(f.TableHeader,{children:(0,t.jsxs)(f.TableRow,{className:"bg-gray-50",children:[(0,t.jsx)(f.TableHead,{children:"Patient"}),(0,t.jsx)(f.TableHead,{children:"Phone"}),(0,t.jsx)(f.TableHead,{children:"Reason"}),(0,t.jsx)(f.TableHead,{children:"Follow-up Date"}),(0,t.jsx)(f.TableHead,{children:"Method"}),(0,t.jsx)(f.TableHead,{children:"Status"}),(0,t.jsx)(f.TableHead,{className:"text-right",children:"Actions"})]})}),(0,t.jsx)(f.TableBody,{children:0===E.length?(0,t.jsx)(f.TableRow,{children:(0,t.jsxs)(f.TableCell,{colSpan:7,className:"py-10 text-center text-sm text-gray-500",children:["No reminders for ",T,"."]})}):E.map(e=>{var a;let l=e.status||"ACTIVE",s="ACTIVE"===l;return(0,t.jsxs)(f.TableRow,{className:s?"":"opacity-80",children:[(0,t.jsx)(f.TableCell,{children:(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("span",{children:e.patientName}),(0,t.jsx)("span",{className:"text-[10px] text-gray-500"})]})}),(0,t.jsx)(f.TableCell,{children:e.patientPhone?(0,t.jsxs)("div",{className:"flex items-center gap-2 cursor-pointer",children:[(0,t.jsx)("span",{children:e.patientPhone}),(0,t.jsx)(m.Button,{type:"button",variant:"ghost",className:"cursor-pointer",size:"icon",onClick:()=>{var t;return t=String(e.patientPhone),void navigator.clipboard.writeText(t).then(()=>n.toast.success("Copied")).catch(()=>n.toast.error("Copy failed"))},children:(0,t.jsx)(i.Copy,{className:"h-4 w-4 "})})]}):"—"}),(0,t.jsx)(f.TableCell,{children:e.reason??"—"}),(0,t.jsx)(f.TableCell,{children:e.followUpDate}),(0,t.jsx)(f.TableCell,{children:(a=e.contactMethod?String(e.contactMethod):"")?"CALL"===a?"Call":"SMS"===a?"SMS":"WHATSAPP"===a?"WhatsApp":a:"—"}),(0,t.jsx)(f.TableCell,{children:(0,t.jsx)(v,{status:l})}),(0,t.jsx)(f.TableCell,{className:"text-right",children:(0,t.jsxs)("div",{className:"flex justify-end gap-2",children:[e.patientPhone&&(0,t.jsx)("a",{href:`tel:${e.patientPhone}`,children:(0,t.jsxs)(m.Button,{variant:"outline",size:"sm",className:"cursor-pointer",children:[(0,t.jsx)(o,{className:"mr-2 h-4 w-4"}),"Call"]})}),(0,t.jsx)(r.default,{href:`/patients/${e.patientId}`,children:(0,t.jsx)(m.Button,{variant:"outline",size:"sm",className:"cursor-pointer",children:"Open"})}),(0,t.jsxs)(m.Button,{size:"sm",onClick:()=>void U(e.visitId,e.followupId),className:"cursor-pointer",disabled:!s||B.isLoading,title:s?"Mark as done":"Already resolved",children:[(0,t.jsx)(c.CheckCircle2,{className:"mr-2 h-4 w-4"}),"Done"]}),(0,t.jsxs)(m.Button,{size:"sm",variant:"outline",className:"cursor-pointer",onClick:()=>void $(e.visitId,e.followupId),disabled:!s||B.isLoading,title:s?"Cancel":"Already resolved",children:[(0,t.jsx)(u,{className:"mr-2 h-4 w-4"}),"Cancel"]})]})})]},e.followupId)})})]})]})})]})})}e.s(["default",()=>j],54990)}]);