(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,92851,t=>{"use strict";var e=t.i(43476),i=t.i(71645),a=t.i(82879),r=t.i(70931),d=t.i(32595);let s=(0,t.i(70703).default)(()=>t.A(35154).then(t=>t.PrescriptionPreview),{loadableGenerated:{modules:[89181]},ssr:!1});function n(t){return"object"==typeof t&&null!==t}function o(t,e){if(n(t))return t[e]}function l(t,e){let i=o(t,e);return"string"==typeof i&&i.trim()?i:void 0}function u(t,e){let i=o(t,e);return"number"==typeof i&&Number.isFinite(i)?i:void 0}function c(t){if(!t)return null;let e=t instanceof Date?t:new Date(t);return Number.isFinite(e.getTime())?e:null}function p(t){let{open:p,onOpenChange:h,visitId:g,patientId:m,patientName:v,patientPhone:f,patientSdId:I,opdNo:x,doctorName:A,doctorRegdLabel:y}=t,M=(0,r.useGetVisitRxQuery)({visitId:g??""},{skip:!p||!g}),b=(0,r.useGetVisitByIdQuery)(g??"",{skip:!p||!g}),D=(0,r.useGetPatientByIdQuery)(m??"",{skip:!p||!m}),V=(0,r.useGetPatientVisitsQuery)(m??"",{skip:!p||!m,refetchOnMountOrArgChange:!0}),F=i.useMemo(()=>{let t=o(V.data,"items");return Array.isArray(t)?t:[]},[V.data]),N=i.useMemo(()=>c(o(b.data,"createdAt")),[b.data]),O=i.useMemo(()=>{let t=N?.getTime();return t?`Visit: ${(0,d.clinicDateISO)(new Date(t))}`:""},[N]),j=i.useMemo(()=>{let t=String(o(D.data,"gender")??o(D.data,"sex")??o(D.data,"patientSex")??"").trim().toUpperCase();return"M"===t||"F"===t||"O"===t||"U"===t?t:"MALE"===t?"M":"FEMALE"===t?"F":"OTHER"===t?"O":void 0},[D.data]),w=i.useMemo(()=>{let t=c(o(D.data,"dob")??o(D.data,"dateOfBirth")??o(D.data,"birthDate")??o(D.data,"dobIso")??null),e=N??new Date;if(t){let i,a;return i=e.getFullYear()-t.getFullYear(),((a=e.getMonth()-t.getMonth())<0||0===a&&e.getDate()<t.getDate())&&(i-=1),i<0?0:i}},[D.data,N]),P=o(M.data,"rx"),T=n(P)?o(P,"lines"):void 0,S=Array.isArray(T)?T:[],k=i.useMemo(()=>{if(!P||!n(P))return[];let t=o(P,"toothDetails");return Array.isArray(t)?t:[]},[P]),C=i.useMemo(()=>{let t=g??"",e=new Map;for(let t of F)e.set(t.visitId,t);let i=b.data,a=l(i,"visitId");a&&e.set(a,i);let r=e.get(t)??i,d=l(r,"tag"),s=l(r,"anchorVisitId"),n="F"===d?s:t;if(!n)return{visitIds:t?[t]:[],meta:e,currentVisitId:t};let o=[],c=e.get(n);c&&o.push(c);let p=[];for(let t of e.values()){let e=l(t,"anchorVisitId")??l(t,"anchorId")??void 0;e&&e===n&&t.visitId!==n&&p.push(t)}if(p.sort((t,e)=>(u(t,"createdAt")??0)-(u(e,"createdAt")??0)),o.push(...p),t&&!o.some(e=>e.visitId===t)){let i=e.get(t);o.push(i??{visitId:t})}o.sort((t,e)=>(u(t,"createdAt")??u(t,"updatedAt")??0)-(u(e,"createdAt")??u(e,"updatedAt")??0));let h=new Set,m=o.map(t=>t.visitId).filter(t=>!(!t||h.has(t))&&(h.add(t),!0)),v=t?m.indexOf(t):-1;return{visitIds:v>=0?m.slice(0,v+1):m,meta:e,currentVisitId:t}},[F,g,b.data]),L=i.useMemo(()=>{let t=o(b.data,"opdNo")??o(b.data,"opdNumber")??o(b.data,"opdId")??o(b.data,"opd")??o(b.data,"opd_no")??o(b.data,"opd_no_str")??void 0;return(null==t?"":String(t).trim())||void 0},[b.data]);return(0,e.jsx)(a.Dialog,{open:p,onOpenChange:h,children:(0,e.jsxs)(a.DialogContent,{className:"max-w-5xl rounded-2xl",children:[(0,e.jsx)(a.DialogHeader,{children:(0,e.jsx)(a.DialogTitle,{children:"Prescription"})}),(0,e.jsx)("div",{className:"min-w-0 overflow-x-hidden rounded-2xl border bg-white p-4",children:M.isFetching||b.isFetching||D.isFetching?(0,e.jsx)("div",{className:"text-sm text-gray-500",children:"Loadingâ€¦"}):g?(0,e.jsx)(s,{patientName:o(D.data,"name")??v,patientPhone:o(D.data,"phone")??f,patientAge:w,patientSex:j,sdId:o(D.data,"sdId")??I,opdNo:L??x,doctorName:A,doctorRegdLabel:y,visitDateLabel:O,lines:S,toothDetails:k,currentVisitId:C.currentVisitId,chainVisitIds:C.visitIds,visitMetaMap:C.meta}):(0,e.jsx)("div",{className:"text-sm text-gray-500",children:"Invalid visit."})})]})})}t.s(["VisitPrescriptionQuickLookDialog",()=>p])},85032,t=>{t.n(t.i(92851))}]);