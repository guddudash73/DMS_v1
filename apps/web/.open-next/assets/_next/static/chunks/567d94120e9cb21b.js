(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,68144,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(18566),i=e.i(70319),r=e.i(70931),l=e.i(70317),d=e.i(66691),n=e.i(24911);let c=e=>e&&"object"==typeof e&&"string"==typeof e.error?{error:e.error,message:"string"==typeof e.message?e.message:void 0,fieldErrors:e.fieldErrors&&"object"==typeof e.fieldErrors?e.fieldErrors:void 0,traceId:"string"==typeof e.traceId?e.traceId:void 0}:null;function o(e){return"object"==typeof e&&null!==e}function m(e){return"string"==typeof e&&e.trim()?e:void 0}function x(){let e=(0,a.useRouter)(),x=(0,a.useSearchParams)().get("patientId"),[u,h]=s.useState(""),[p,g]=s.useState("N"),[f,N]=s.useState(!1),[j,v]=s.useState(void 0),[y,b]=s.useState(!1),{data:w,isLoading:C,error:I}=(0,r.useGetPatientByIdQuery)(x,{skip:!x}),k=(0,r.useGetPatientVisitsQuery)(x,{skip:!x}),[S]=(0,r.useCreateVisitMutation)(),F=s.useMemo(()=>{if(!I)return null;let e=c(I.data);return e?.message??"Unable to load patient."},[I]),A=()=>{e.back()},D=s.useMemo(()=>{let e=k.data&&o(k.data)?k.data.items:void 0;return(Array.isArray(e)?e:[]).map(e=>{var t;if(!o(e))return null;let s=m(e.visitId);return s?{visitId:s,visitDate:m(e.visitDate),createdAt:"number"==typeof(t=e.createdAt)&&Number.isFinite(t)?t:void 0,opdNo:m(e.opdNo),tag:m(e.tag)}:null}).filter(e=>!!e).filter(e=>e.visitId&&"N"===e.tag).slice().sort((e,t)=>(t.createdAt??0)-(e.createdAt??0))},[k.data]);s.useEffect(()=>{"F"!==p?v(void 0):v(e=>e??D[0]?.visitId??void 0)},[p,D]);let P=async e=>{if(e.preventDefault(),!x)return void i.toast.error("Missing patient information.");if(!u.trim())return void i.toast.error("Please enter a reason for the visit.");if("F"===p&&!j)return void i.toast.error("Please select the New (N) visit this follow-up refers to.");let t={patientId:x,reason:u.trim(),...p?{tag:p}:{},...f?{zeroBilled:!0}:{},..."F"===p&&j?{anchorVisitId:j}:{}};try{b(!0),await S(t).unwrap(),i.toast.success("Visit registered and added to the queue."),A()}catch(t){console.error(t);let e=c(t.data);i.toast.error(e?.message??"Failed to register visit. Please try again.")}finally{b(!1)}};if(!x)return(0,t.jsx)("section",{className:"flex h-full items-center justify-center",children:(0,t.jsx)("p",{className:"text-sm text-red-600",children:"No patient selected for visit."})});let B=w&&o(w)&&"sdId"in w?m(w.sdId):void 0;return(0,t.jsx)("section",{className:"relative h-full",children:(0,t.jsx)("div",{className:"absolute inset-0 z-30 flex items-center justify-center bg-black/10 backdrop-blur-sm",children:(0,t.jsxs)(l.Card,{className:"w-full max-w-2xl rounded-2xl border-none bg-white shadow-lg",children:[(0,t.jsx)(l.CardHeader,{className:"pb-4",children:(0,t.jsx)(l.CardTitle,{className:"text-xl font-semibold text-gray-900",children:"Register Checkup"})}),(0,t.jsxs)(l.CardContent,{className:"pt-0",children:[C&&(0,t.jsxs)("div",{className:"mb-4 space-y-2 text-sm text-gray-600","aria-busy":"true",children:[(0,t.jsx)("div",{className:"h-4 w-40 animate-pulse rounded bg-gray-100"}),(0,t.jsx)("div",{className:"h-4 w-32 animate-pulse rounded bg-gray-100"})]}),!C&&F&&(0,t.jsx)("p",{className:"mb-4 text-sm text-red-600",children:F}),!C&&w&&(0,t.jsxs)("div",{className:"mb-5 grid grid-cols-1 gap-3 text-sm text-gray-800 md:grid-cols-2",children:[(0,t.jsxs)("dl",{className:"space-y-1",children:[(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("dt",{className:"w-24 text-gray-500",children:"Name"}),(0,t.jsx)("dd",{children:w.name})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("dt",{className:"w-24 text-gray-500",children:"Contact No."}),(0,t.jsx)("dd",{children:w.phone??"—"})]})]}),(0,t.jsxs)("dl",{className:"space-y-1 md:justify-self-end",children:[(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("dt",{className:"w-28 text-gray-500",children:"Regd. Date"}),(0,t.jsx)("dd",{children:w.createdAt?new Date(w.createdAt).toLocaleDateString("en-GB"):"—"})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("dt",{className:"w-28 text-gray-500",children:"SD-ID"}),(0,t.jsx)("dd",{children:B??w.patientId})]})]})]}),(0,t.jsxs)("form",{className:"space-y-4",onSubmit:P,children:[(0,t.jsx)("div",{className:"grid gap-4 md:grid-cols-[1.1fr_0.9fr]",children:(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-800",children:"Tag"}),(0,t.jsxs)("div",{className:"flex items-center gap-4 text-xs text-gray-700",children:[(0,t.jsxs)("label",{className:"inline-flex items-center gap-1",children:[(0,t.jsx)("input",{type:"radio",className:"h-3 w-3",value:"N",checked:"N"===p,onChange:()=>g("N")}),(0,t.jsx)("span",{children:"N"})]}),(0,t.jsxs)("label",{className:"inline-flex items-center gap-1",children:[(0,t.jsx)("input",{type:"radio",className:"h-3 w-3",value:"F",checked:"F"===p,onChange:()=>g("F")}),(0,t.jsx)("span",{children:"F"})]}),(0,t.jsxs)("label",{className:"inline-flex items-center gap-2 ml-2",children:[(0,t.jsx)("input",{type:"checkbox",className:"h-3 w-3",checked:f,onChange:e=>N(e.target.checked)}),(0,t.jsx)("span",{children:"Zero billed (Z)"})]})]})]})}),"F"===p?(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{className:"text-sm font-medium text-gray-800",children:"Follow-up for New (N) Visit"}),(0,t.jsx)("select",{className:"h-10 w-full rounded-xl border border-gray-200 bg-white px-3 text-sm",value:j??"",onChange:e=>v(e.target.value||void 0),children:0===D.length?(0,t.jsx)("option",{value:"",children:"No prior N visits found"}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("option",{value:"",children:"Select an N visit…"}),D.map(e=>{let s,a,i;return(0,t.jsx)("option",{value:e.visitId,children:(s=e.visitDate?String(e.visitDate):"—",a=e.visitId?`#${String(e.visitId).slice(0,8)}`:"",i=e.opdNo?String(e.opdNo):a,`${s} • ${i}`)},e.visitId)})]})}),(0,t.jsx)("p",{className:"h-3 text-xs",children:" "})]}):null,(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("label",{htmlFor:"reason",className:"text-sm font-medium text-gray-800",children:"Reason"}),(0,t.jsx)(n.Input,{id:"reason",placeholder:"Enter the reason for this visit",className:"h-10 rounded-xl text-sm",value:u,onChange:e=>h(e.target.value)})]}),(0,t.jsxs)("div",{className:"mt-3 flex justify-end gap-2",children:[(0,t.jsx)(d.Button,{type:"button",variant:"ghost",className:"h-10 rounded-xl px-4 text-sm",onClick:A,disabled:y,children:"Cancel"}),(0,t.jsx)(d.Button,{type:"submit",disabled:y,className:"h-10 rounded-xl bg-black px-6 text-sm font-medium text-white hover:bg-black/90",children:y?"Creating…":"Create Visit"})]})]})]})]})})})}e.s(["default",()=>x])}]);