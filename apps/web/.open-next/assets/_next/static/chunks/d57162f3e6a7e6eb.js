(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,73708,e=>{"use strict";let t=(0,e.i(75254).default)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);e.s(["Image",()=>t],73708)},45680,e=>{"use strict";var t=e.i(43476),i=e.i(71645),s=e.i(70703),a=e.i(18566),r=e.i(70317),d=e.i(70931);let n=(0,e.i(75254).default)("clipboard-list",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);var l=e.i(73708);let o=(0,s.default)(()=>e.A(35154).then(e=>e.PrescriptionPreview),{loadableGenerated:{modules:[89181]},ssr:!1}),c=(0,s.default)(()=>e.A(2179).then(e=>e.XrayTrayReadOnly),{loadableGenerated:{modules:[77950]},ssr:!1}),h=(0,s.default)(()=>e.A(64840).then(e=>e.DoctorVisitHistoryPanel),{loadableGenerated:{modules:[42352]},ssr:!1,loading:()=>(0,t.jsxs)(r.Card,{className:"mt-4 w-full rounded-2xl border bg-white p-4",children:[(0,t.jsx)("div",{className:"h-5 w-40 animate-pulse rounded bg-gray-100"}),(0,t.jsx)("div",{className:"mt-4 h-24 animate-pulse rounded-xl bg-gray-50"})]})}),u=(0,s.default)(()=>e.A(75701).then(e=>e.VisitPrescriptionQuickLookDialog),{loadableGenerated:{modules:[85032]},ssr:!1}),p=(0,s.default)(()=>e.A(13689).then(e=>e.VisitXrayQuickLookDialog),{loadableGenerated:{modules:[30916]},ssr:!1});function m(e){return"object"==typeof e&&null!==e}function g(e,t){if(m(e))return e[t]}function x(e,t){var i;return"string"==typeof(i=g(e,t))&&i.trim()?i:void 0}function v(e,t){var i;return"number"==typeof(i=g(e,t))&&Number.isFinite(i)?i:void 0}function y(e){let s=(0,a.useRouter)(),{visitId:y,patientId:f,patient:b,visit:j,doctorName:I,doctorRegdLabel:N,visitDate:k,visitDateLabel:A,opdNo:w,rxLatest:V}=e,[P,M]=i.useState(!1),O=(0,d.useGetPatientVisitsQuery)(f??"",{skip:!f||!P,refetchOnMountOrArgChange:!0}),S=i.useMemo(()=>{if(!P)return[];let e=g(O.data,"items");return Array.isArray(e)?e:[]},[O.data,P]),C=(0,d.useGetVisitRxQuery)({visitId:y}),D=C.data?.rx??(m(V)?V:null),L=Array.isArray(g(D,"lines"))?g(D,"lines"):[],R=Array.isArray(g(D,"toothDetails"))?g(D,"toothDetails"):[],G=i.useMemo(()=>{let e=new Map;if(j?.visitId&&e.set(j.visitId,j),!P)return{visitIds:[y],meta:e,currentVisitId:y};for(let t of S)t?.visitId&&e.set(t.visitId,t);j?.visitId&&e.set(j.visitId,j);let t=x(j,"tag"),i=x(j,"anchorVisitId"),s="F"===t?i:y;if(!s)return{visitIds:[y],meta:e,currentVisitId:y};let a=e.get(s),r=[];a&&r.push(a);let d=[];for(let t of e.values()){let e=x(t,"anchorVisitId")??x(t,"anchorId");e&&e===s&&t.visitId!==s&&d.push(t)}if(d.sort((e,t)=>(v(e,"createdAt")??v(e,"updatedAt")??0)-(v(t,"createdAt")??v(t,"updatedAt")??0)),r.push(...d),!r.some(e=>e.visitId===y)){let t=e.get(y);r.push(t??{visitId:y})}r.sort((e,t)=>(v(e,"createdAt")??v(e,"updatedAt")??0)-(v(t,"createdAt")??v(t,"updatedAt")??0));let n=new Set,l=r.map(e=>e.visitId).filter(e=>!(!e||n.has(e))&&(n.add(e),!0)),o=l.indexOf(y);return{visitIds:o>=0?l.slice(0,o+1):[y],meta:e,currentVisitId:y}},[S,P,j,y]),Q=P&&(O.isLoading||O.isFetching),[T,F]=i.useState(!1),[X,H]=i.useState(!1),[$,B]=i.useState(null);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-12",children:[(0,t.jsxs)(r.Card,{className:"lg:col-span-6 rounded-2xl border bg-white p-4",children:[(0,t.jsxs)("div",{className:"mb-3 flex gap-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex gap-1 items-center",children:[(0,t.jsx)(n,{className:"h-4 w-4 text-gray-700"}),(0,t.jsx)("div",{className:"text-sm font-semibold text-gray-900",children:"Prescription"})]}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:k?k.trim():""})]}),P?(0,t.jsx)("div",{className:"rounded-x pl-1 text-[11px] text-gray-600",children:Q?"Loading visit historyâ€¦":`Showing visit history (${G.visitIds.length} visit${1===G.visitIds.length?"":"s"}).`}):null,(0,t.jsx)("div",{className:"ml-auto flex items-center gap-2",children:(0,t.jsx)("button",{type:"button",className:["rounded-full px-3 py-1 text-[11px] font-medium transition cursor-pointer",P?"bg-black text-white hover:bg-black/90":"bg-gray-100 text-gray-800 hover:bg-gray-200"].join(" "),onClick:()=>M(e=>!e),title:"Toggle previous visit history in prescription",children:P?"Hide history":"Show history"})})]}),(0,t.jsx)("div",{className:"min-w-0 overflow-x-hidden",children:(0,t.jsx)(o,{patientName:g(b,"name"),patientPhone:g(b,"phone"),patientAge:void 0,patientSex:void 0,sdId:g(b,"sdId"),opdNo:w,doctorName:I,doctorRegdLabel:N,visitDateLabel:A,lines:L,receptionNotes:m(D)?String(g(D,"receptionNotes")??""):"",toothDetails:R,currentVisitId:P?G.currentVisitId:void 0,chainVisitIds:P?G.visitIds:void 0,visitMetaMap:P?G.meta:void 0})})]}),(0,t.jsxs)(r.Card,{className:"lg:col-span-6 rounded-2xl border bg-white p-4",children:[(0,t.jsxs)("div",{className:"mb-3 flex items-center gap-2",children:[(0,t.jsx)(l.Image,{className:"h-4 w-4 text-gray-700"}),(0,t.jsx)("div",{className:"text-sm font-semibold text-gray-900",children:"X-rays"}),(0,t.jsx)("div",{className:"ml-auto text-xs text-gray-500",children:"All images for this visit"})]}),(0,t.jsx)("div",{className:"min-h-60",children:(0,t.jsx)(c,{visitId:y})})]})]}),(0,t.jsx)(h,{patientId:f,onOpenVisit:e=>s.push(`/doctor/visits/${e}`),onOpenRxQuick:e=>{B(e),F(!0)},onOpenXrayQuick:e=>{B(e),H(!0)}}),(0,t.jsx)(u,{open:T,onOpenChange:F,visitId:$,patientId:f,patientName:"string"==typeof g(b,"name")?g(b,"name"):void 0,patientPhone:"string"==typeof g(b,"phone")?g(b,"phone"):void 0,patientSdId:"string"==typeof g(b,"sdId")?g(b,"sdId"):void 0,opdNo:w,doctorName:I,doctorRegdLabel:N}),(0,t.jsx)(p,{open:X,onOpenChange:H,visitId:$})]})}e.s(["DoctorVisitDoneView",()=>y],45680)},17522,e=>{e.n(e.i(45680))},35154,e=>{e.v(t=>Promise.all(["static/chunks/857324084bba1f93.js"].map(t=>e.l(t))).then(()=>t(89181)))},2179,e=>{e.v(t=>Promise.all(["static/chunks/569111530486137f.js"].map(t=>e.l(t))).then(()=>t(77950)))},64840,e=>{e.v(t=>Promise.all(["static/chunks/b2ec253d80877f9d.js"].map(t=>e.l(t))).then(()=>t(42352)))},75701,e=>{e.v(t=>Promise.all(["static/chunks/90d1f58f5d465dfb.js"].map(t=>e.l(t))).then(()=>t(85032)))},13689,e=>{e.v(t=>Promise.all(["static/chunks/d12ee2e27c67c9b1.js"].map(t=>e.l(t))).then(()=>t(30916)))}]);