(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,23621,e=>{"use strict";var t=e.i(43476),s=e.i(91918),i=e.i(25913),r=e.i(52236);let a=(0,i.cva)("inline-flex items-center justify-center rounded-full border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function n({className:e,variant:i,asChild:n=!1,...l}){let d=n?s.Slot:"span";return(0,t.jsx)(d,{"data-slot":"badge",className:(0,r.cn)(a({variant:i}),e),...l})}e.s(["Badge",()=>n])},67585,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"BailoutToCSR",{enumerable:!0,get:function(){return r}});let i=e.r(32061);function r({reason:e,children:t}){if("undefined"==typeof window)throw Object.defineProperty(new i.BailoutToCSRError(e),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});return t}},9885,(e,t,s)=>{"use strict";function i(e){return e.split("/").map(e=>encodeURIComponent(e)).join("/")}Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"encodeURIPath",{enumerable:!0,get:function(){return i}})},52157,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"PreloadChunks",{enumerable:!0,get:function(){return d}});let i=e.r(43476),r=e.r(74080),a=e.r(63599),n=e.r(9885),l=e.r(43369);function d({moduleIds:e}){if("undefined"!=typeof window)return null;let t=a.workAsyncStorage.getStore();if(void 0===t)return null;let s=[];if(t.reactLoadableManifest&&e){let i=t.reactLoadableManifest;for(let t of e){if(!i[t])continue;let e=i[t].files;s.push(...e)}}if(0===s.length)return null;let d=(0,l.getDeploymentIdQueryOrEmptyString)();return(0,i.jsx)(i.Fragment,{children:s.map(e=>{let s=`${t.assetPrefix}/_next/${(0,n.encodeURIPath)(e)}${d}`;return e.endsWith(".css")?(0,i.jsx)("link",{precedence:"dynamic",href:s,rel:"stylesheet",as:"style",nonce:t.nonce},e):((0,r.preload)(s,{as:"script",fetchPriority:"low",nonce:t.nonce}),null)})})}},69093,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"default",{enumerable:!0,get:function(){return o}});let i=e.r(43476),r=e.r(71645),a=e.r(67585),n=e.r(52157);function l(e){return{default:e&&"default"in e?e.default:e}}let d={loader:()=>Promise.resolve(l(()=>null)),loading:null,ssr:!0},o=function(e){let t={...d,...e},s=(0,r.lazy)(()=>t.loader().then(l)),o=t.loading;function c(e){let l=o?(0,i.jsx)(o,{isLoading:!0,pastDelay:!0,error:null}):null,d=!t.ssr||!!t.loading,c=d?r.Suspense:r.Fragment,u=t.ssr?(0,i.jsxs)(i.Fragment,{children:["undefined"==typeof window?(0,i.jsx)(n.PreloadChunks,{moduleIds:t.modules}):null,(0,i.jsx)(s,{...e})]}):(0,i.jsx)(a.BailoutToCSR,{reason:"next/dynamic",children:(0,i.jsx)(s,{...e})});return(0,i.jsx)(c,{...d?{fallback:l}:{},children:u})}return c.displayName="LoadableComponent",c}},70703,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"default",{enumerable:!0,get:function(){return r}});let i=e.r(55682)._(e.r(69093));function r(e,t){let s={};"function"==typeof e&&(s.loader=e);let r={...s,...t};return(0,i.default)({...r,modules:r.loadableGenerated?.modules})}("function"==typeof s.default||"object"==typeof s.default&&null!==s.default)&&void 0===s.default.__esModule&&(Object.defineProperty(s.default,"__esModule",{value:!0}),Object.assign(s.default,s),t.exports=s.default)},72520,e=>{"use strict";let t=(0,e.i(75254).default)("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);e.s(["ArrowRight",()=>t],72520)},20286,e=>{"use strict";let t=(0,e.i(75254).default)("stethoscope",[["path",{d:"M11 2v2",key:"1539x4"}],["path",{d:"M5 2v2",key:"1yf1q8"}],["path",{d:"M5 3H4a2 2 0 0 0-2 2v4a6 6 0 0 0 12 0V5a2 2 0 0 0-2-2h-1",key:"rb5t3r"}],["path",{d:"M8 15a6 6 0 0 0 12 0v-3",key:"x18d4x"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]]);e.s(["Stethoscope",()=>t],20286)},45892,e=>{"use strict";var t=e.i(43476),s=e.i(71645),i=e.i(70703),r=e.i(18566),a=e.i(70319),n=e.i(70317),l=e.i(66691),d=e.i(23621),o=e.i(70931),c=e.i(50106),u=e.i(72520),x=e.i(20286);let m=(0,i.default)(()=>e.A(28648).then(e=>e.DoctorVisitDoneView),{loadableGenerated:{modules:[17522]},ssr:!1,loading:()=>(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-12",children:[(0,t.jsxs)(n.Card,{className:"lg:col-span-6 rounded-2xl border bg-white p-4",children:[(0,t.jsx)("div",{className:"h-5 w-40 animate-pulse rounded bg-gray-100"}),(0,t.jsx)("div",{className:"mt-4 h-80 animate-pulse rounded-xl bg-gray-50"})]}),(0,t.jsxs)(n.Card,{className:"lg:col-span-6 rounded-2xl border bg-white p-4",children:[(0,t.jsx)("div",{className:"h-5 w-24 animate-pulse rounded bg-gray-100"}),(0,t.jsx)("div",{className:"mt-4 h-80 animate-pulse rounded-xl bg-gray-50"})]})]})});function g(e){return"object"==typeof e&&null!==e}function f(e){return"string"==typeof e&&e.trim()?e:void 0}function p(e,t){if(g(e))return e[t]}function h(e){if(e instanceof Error&&e.message)return e.message;if(g(e)){let t=p(e,"data");if(g(t)){let e=f(p(t,"message"));if(e)return e}let s=f(p(e,"message"));if(s)return s}return"Request failed."}function b(e){if(!e)return null;let t=String(e).trim(),s=/^(\d{4})-(\d{2})-(\d{2})$/.exec(t);if(!s)return null;let i=new Date(Number(s[1]),Number(s[2])-1,Number(s[3]));return Number.isNaN(i.getTime())?null:i}function v(e){return"QUEUED"===e?"Waiting":"IN_PROGRESS"===e?"In Progress":"DONE"===e?"Done":"—"}function y(){let e,i=(0,r.useParams)(),y=(0,r.useRouter)(),j=(0,c.useAuth)(),N=s.useMemo(()=>String(i?.visitId??""),[i?.visitId]),w=j.userId??"",S=(0,o.useGetVisitByIdQuery)(N,{skip:!N}),O=S.data??null,P=!!O?.isOffline,R=O?.patientId??"",D=(0,o.useGetPatientByIdQuery)(R,{skip:!R}),k=p((0,o.useGetVisitRxQuery)({visitId:N},{skip:!N}).data,"rx")??null,[E,M]=(0,o.useUpdateVisitStatusMutation)(),[I,_]=(0,o.useStartVisitRxRevisionMutation)(),C=(0,o.useGetDoctorsQuery)(void 0),F=s.useMemo(()=>{let e=C.data;return w&&Array.isArray(e)?e.filter(g).map(e=>e).find(e=>e.doctorId===w)??null:null},[C.data,w]),L=s.useMemo(()=>F?.fullName??F?.displayName??F?.name??(w?`Doctor (${w})`:"Doctor"),[F,w]),U=s.useMemo(()=>{let e=F?.registrationNumber;return e?`B.D.S Regd. - ${e}`:void 0},[F]),B=O?.status,A="DONE"===B,T=O?.visitDate??"",V=T?`Visit: ${T}`:void 0,$=D.data??null,G="M"===(e=String(p($,"gender")??p($,"sex")??p($,"patientSex")??"").trim().toUpperCase())||"MALE"===e?"M":"F"===e||"FEMALE"===e?"F":"O"===e||"OTHER"===e?"O":"U",Q=function(e,t){let s=b(e);if(!s)return null;let i=(t?b(t):null)??new Date,r=i.getFullYear()-s.getFullYear(),a=i.getMonth()-s.getMonth();return((a<0||0===a&&i.getDate()<s.getDate())&&(r-=1),!Number.isFinite(r)||r<0||r>130)?null:r}(f(p($,"dob")),T)??void 0,z=f(O?.opdNo)??f(O?.opdId)??void 0,q=S.isLoading||D.isLoading,W=S.isError||D.isError,X=!0===P,Y="This is an offline visit. Session editing is disabled in Doctor view.",H=async()=>{if(N){if(X)return void a.toast.info(Y);try{await I({visitId:N}).unwrap(),a.toast.success("Revision started."),y.push(`/doctor/visits/${N}/prescription`)}catch(e){a.toast.error(h(e)??"Failed to start revision.")}}},K=async()=>{if(X)return void a.toast.info(Y);if(N){if(!w)return void a.toast.error("Missing doctor session. Please re-login.");if("IN_PROGRESS"===B)return void y.push(`/doctor/visits/${N}/prescription`);if("QUEUED"===B){try{await E({visitId:N,status:"IN_PROGRESS",date:O?.visitDate}).unwrap(),a.toast.success("Session started."),y.push(`/doctor/visits/${N}/prescription`)}catch(e){a.toast.error(h(e)??"Failed to start session.")}return}y.push(`/doctor/visits/${N}/prescription`)}};return N?(0,t.jsxs)("section",{className:"h-full px-3 py-4 md:px-6 md:py-6 2xl:px-10 2xl:py-10",children:[(0,t.jsxs)("div",{className:"mb-4 flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"text-lg font-semibold text-gray-900",children:"Visit"}),P?(0,t.jsx)("span",{className:"inline-flex items-center rounded-full border border-amber-200 bg-amber-50 px-2 py-0.5 text-[10px] font-semibold text-amber-700",children:"OFFLINE"}):null]}),(0,t.jsxs)("div",{className:"mt-0.5 text-xs text-gray-500",children:[O?.tag?(0,t.jsxs)(t.Fragment,{children:["Tag: ",(0,t.jsx)("span",{className:"font-medium text-gray-700",children:O.tag})," · "]}):null,"Stage: ",(0,t.jsx)("span",{className:"font-medium text-gray-700",children:v(B)})]})]}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center justify-end gap-2",children:[A?(0,t.jsx)(l.Button,{type:"button",variant:"outline",className:"rounded-xl cursor-pointer",onClick:H,disabled:X||_.isLoading||q||W,title:X?Y:"Start editing this DONE visit",children:_.isLoading?"Starting…":"Start Revision"}):null,(0,t.jsx)(l.Button,{type:"button",variant:"outline",className:"rounded-xl cursor-pointer",onClick:()=>y.back(),children:"Back"}),A?null:(0,t.jsxs)(l.Button,{type:"button",className:["rounded-xl cursor-pointer",X?"bg-gray-200 text-gray-600 hover:bg-gray-200":"bg-black text-white hover:bg-black/90"].join(" "),onClick:K,disabled:X||M.isLoading||q||W,title:X?Y:void 0,children:[X?"Session disabled":M.isLoading?"Starting…":"IN_PROGRESS"===B?"Continue Session":"Start Session",(0,t.jsx)(u.ArrowRight,{className:"ml-2 h-4 w-4"})]})]})]}),P?(0,t.jsx)("div",{className:"mb-4 rounded-2xl border border-amber-200 bg-amber-50 px-4 py-3 text-sm text-amber-800",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"mt-0.5 h-2 w-2 rounded-full bg-amber-500"}),(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("div",{className:"font-semibold",children:"Offline visit"}),(0,t.jsx)("div",{className:"mt-0.5 text-xs text-amber-700",children:"Doctor session actions are disabled for offline visits. You can view the summary and history below."})]})]})}):null,W?(0,t.jsx)(n.Card,{className:"rounded-2xl border bg-white p-6",children:(0,t.jsx)("div",{className:"text-sm text-red-600",children:"Failed to load visit/patient."})}):q?(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-12",children:[(0,t.jsxs)(n.Card,{className:"lg:col-span-5 rounded-2xl border bg-white p-6",children:[(0,t.jsx)("div",{className:"h-4 w-48 animate-pulse rounded bg-gray-100"}),(0,t.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,t.jsx)("div",{className:"h-3 w-64 animate-pulse rounded bg-gray-100"}),(0,t.jsx)("div",{className:"h-3 w-56 animate-pulse rounded bg-gray-100"}),(0,t.jsx)("div",{className:"h-3 w-52 animate-pulse rounded bg-gray-100"})]})]}),(0,t.jsxs)(n.Card,{className:"lg:col-span-7 rounded-2xl border bg-white p-6",children:[(0,t.jsx)("div",{className:"h-4 w-56 animate-pulse rounded bg-gray-100"}),(0,t.jsx)("div",{className:"mt-4 h-60 animate-pulse rounded-xl bg-gray-50"})]})]}):A?(0,t.jsx)(m,{visitId:N,patientId:R,patient:$,visit:O,doctorName:L,doctorRegdLabel:U,visitDate:T,visitDateLabel:V,opdNo:z,rxLatest:k}):(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-12",children:[(0,t.jsxs)(n.Card,{className:"lg:col-span-5 rounded-2xl border bg-white p-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(x.Stethoscope,{className:"h-4 w-4 text-gray-700"}),(0,t.jsx)("div",{className:"text-sm font-semibold text-gray-900",children:"Visit Overview"})]}),(0,t.jsxs)("div",{className:"mt-4 grid gap-3 text-sm text-gray-800",children:[(0,t.jsxs)("div",{className:"flex justify-between gap-3",children:[(0,t.jsx)("div",{className:"text-gray-600",children:"Patient"}),(0,t.jsx)("div",{className:"font-semibold text-gray-900",children:String(p($,"name")??"—")})]}),(0,t.jsxs)("div",{className:"flex justify-between gap-3",children:[(0,t.jsx)("div",{className:"text-gray-600",children:"Phone"}),(0,t.jsx)("div",{className:"font-semibold text-gray-900",children:String(p($,"phone")??"—")})]}),(0,t.jsxs)("div",{className:"flex justify-between gap-3",children:[(0,t.jsx)("div",{className:"text-gray-600",children:"Age/Sex"}),(0,t.jsxs)("div",{className:"font-semibold text-gray-900",children:[Q?String(Q):"—","/",G??"—"]})]}),(0,t.jsxs)("div",{className:"flex justify-between gap-3",children:[(0,t.jsx)("div",{className:"text-gray-600",children:"SD-ID"}),(0,t.jsx)("div",{className:"font-semibold text-gray-900",children:String(p($,"sdId")??"—")})]}),(0,t.jsxs)("div",{className:"flex justify-between gap-3",children:[(0,t.jsx)("div",{className:"text-gray-600",children:"OPD No"}),(0,t.jsx)("div",{className:"font-semibold text-gray-900",children:z??"—"})]}),(0,t.jsxs)("div",{className:"flex justify-between gap-3",children:[(0,t.jsx)("div",{className:"text-gray-600",children:"Visit Date"}),(0,t.jsx)("div",{className:"font-semibold text-gray-900",children:T??"—"})]}),(0,t.jsxs)("div",{className:"flex justify-between gap-3",children:[(0,t.jsx)("div",{className:"text-gray-600",children:"Reason"}),(0,t.jsx)("div",{className:"font-semibold text-gray-900",children:String(p(O,"reason")??"—")})]})]})]}),(0,t.jsxs)(n.Card,{className:"lg:col-span-7 rounded-2xl border bg-white p-6",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("div",{className:"text-sm font-semibold text-gray-900",children:"Prescription"}),(0,t.jsxs)("div",{className:"mt-1 text-xs text-gray-500",children:["Prescription preview and X-rays become visible only after the visit is marked as"," ",(0,t.jsx)("b",{children:"DONE"}),"."]})]}),(0,t.jsx)(d.Badge,{variant:"outline",className:`rounded-full px-4 py-1 text-xs font-semibold ${"QUEUED"===B?"bg-pink-100 text-pink-700 border-pink-200":"IN_PROGRESS"===B?"bg-yellow-100 text-yellow-800 border-yellow-200":"DONE"===B?"bg-green-100 text-green-700 border-green-200":"bg-gray-100 text-gray-700 border-gray-200"}`,children:v(B)})]}),(0,t.jsxs)("div",{className:"mt-4 rounded-2xl border p-4",children:[(0,t.jsx)("div",{className:"text-xs font-semibold text-gray-700",children:"What’s next"}),(0,t.jsxs)("ul",{className:"mt-2 list-disc space-y-1 pl-4 text-xs text-gray-600",children:[(0,t.jsx)("li",{children:"Add medicines to Rx"}),(0,t.jsx)("li",{children:"Upload and review X-rays"}),(0,t.jsx)("li",{children:"Finalize and mark visit as DONE"})]})]})]})]})]}):(0,t.jsx)("section",{className:"p-6",children:(0,t.jsx)("p",{className:"text-sm text-red-600",children:"Invalid visit id."})})}function j(){return(0,t.jsx)(y,{})}e.s(["default",()=>j],45892)},28648,e=>{e.v(t=>Promise.all(["static/chunks/d57162f3e6a7e6eb.js"].map(t=>e.l(t))).then(()=>t(17522)))}]);